<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>TổNG QUAN Về DEPENDENCY INJECTION TRONG ANGULARJS (P2) &vert; ACEGIK'S BLOG</title>
<meta name="description" content="... when the sun comes up, you better be running!">
<meta name="keywords" content="JavaScript, AngularJS">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/blog/images/logo.png">
<meta name="twitter:title" content="Tổng quan về Dependency Injection trong AngularJS (P2)">
<meta name="twitter:description" content="... when the sun comes up, you better be running!">
<meta name="twitter:creator" content="@pnhung177">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Tổng quan về Dependency Injection trong AngularJS (P2)">
<meta property="og:description" content="... when the sun comes up, you better be running!">
<meta property="og:url" content="/blog/javascript/angularjs/tong-quan-ve-dependency-injection-trong-angularjs-p2.html">
<meta property="og:site_name" content="Acegik's Blog">
<meta property="og:image" content="/blog/images/">





<link rel="canonical" href="/blog/javascript/angularjs/tong-quan-ve-dependency-injection-trong-angularjs-p2.html">
<link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="Acegik's Blog Feed">
<link rel="author" href="https://plus.google.com/u/3/115458186421626071505?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700|Open+Sans:400,600,300,800,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="/blog/assets/css/font-awesome.min.css">
<link rel="stylesheet" href="/blog/assets/css/vendor/normalize.css">
<link rel="stylesheet" href="/blog/assets/css/vendor/foundation.min.css">
<link rel="stylesheet" href="/blog/assets/css/style.css">
<link rel="stylesheet" href="/blog/assets/css/post.css">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/blog/assets/js/vendor/jquery-1.11.1.min.js"><\/script>')</script>





<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/blog/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/blog/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/blog/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/blog/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/blog/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/blog/images/apple-touch-icon-144x144-precomposed.png">

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Acegik - sidebar -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2558234225933836"
     data-ad-slot="3073080904"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

</head>
<body class="post-template" itemscope itemtype="http://schema.org/WebPage">


        <main id="cheryk-post-container-simple" class="cheryk-post-container-simple" role="main">
            <header class="cheryk-post-header-simple">
                <div class="cheryk-post-menu-header-simple">

                    <a class="cheryk-blog-logo" href="/blog">
                        <img src="/blog/images/logo.png" alt="Blog Logo" />
                    </a>

                <div class="cheryk-blog-menu">      
    <div class="cheryk-mobile-menu show-for-small">
        <a href="#"><i class="fa fa-bars"></i></a>
    </div>
    <ul class="cheryk-menu">
        <li class="cheryk-mobile-close-btn show-for-small text-right">
            <a href="#"><i class="fa fa-times"></i></a>
        </li>

            <li>
                    <a href="/blog/">Trang bìa</a>
                 </li>

            <li>
                    <a href="/blog/featured">Danh sách</a>
                 </li>

            <li>
                    <a href="/blog/categories">Phân loại</a>
                 </li>

            <li>
                    <a href="/blog/about">Giới thiệu</a>
                 </li>
            
           <li><a href="/blog/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
    </ul>

</div>
            </div>

                <div class="cheryk-post-title-simple row">
                    <div class="small-12 columns">
                        <div class="cheryk-post-meta-simple">
                            <h1>Tổng quan về Dependency Injection trong AngularJS (P2)</h1>
                            <p>by <strong>pnhung177</strong> &#8212; on <a href="/blog/tags/index.html#JavaScript" data-toggle="tooltip" title="Posts tagged with JavaScript" rel="tag">JavaScript</a>&nbsp;&comma;&nbsp;<a href="/blog/tags/index.html#AngularJS" data-toggle="tooltip" title="Posts tagged with AngularJS" rel="tag">AngularJS</a> &#8212; <strong><time datetime="2014-10-17T00:00:00+07:00">17/10/2014</time></strong></p>
                        </div>
                    </div>
                </div>
            </header>

        <article class="cheryk-post-content post tag-simple">
            <div><p>Có thể nói, mẫu hình thiết kế <strong>Dependency Injection</strong> tạo thành xương sống của toàn bộ kiến trúc AngularJS. Nhờ mẫu hình thiết kế này mà các thành phần của AngularJS được tách rời cô lập nhau khi xây dựng, và tự động gắn kết lại khi vận hành. Việc này giúp giảm đáng kể công sức của các nhà phát triển dụng trong nỗ lực chia tách ứng dụng để dễ dàng phát triển và kiểm thử cũng như lắp ghép các thành phần lại thành ứng dụng hoàn chỉnh.</p>

<section>
  <header>
    <h2>Nội dung trình bày</h2>
  </header>
<div id="drawer">
<ul id="markdown-toc">
  <li><a href="#dependency-injection-trong-angularjs">Dependency Injection trong AngularJS</a>    <ul>
      <li><a href="#cc-thut-ng-quy-c">Các thuật ngữ quy ước</a></li>
      <li><a href="#cu-trc-dependency-injection-trong-angularjs">Cấu trúc Dependency Injection trong AngularJS</a>        <ul>
          <li><a href="#i-tng-dch-v-provide">Đối tượng dịch vụ $provide</a>            <ul>
              <li><a href="#hm-factory">Hàm factory()</a></li>
              <li><a href="#hm-service">Hàm service()</a></li>
              <li><a href="#hm-value">Hàm value()</a></li>
            </ul>
          </li>
          <li><a href="#i-tng-dch-v-injector">Đối tượng dịch vụ $injector</a>            <ul>
              <li><a href="#hm-injectorget">Hàm $injector.get()</a></li>
              <li><a href="#hm-injectorinvoke">Hàm $injector.invoke()</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#ch-gii-ph-thuc-dependency-annotation">Chú giải phụ thuộc (Dependency Annotation)</a>        <ul>
          <li><a href="#ch-gii-suy-din-annotation-by-inference">Chú giải suy diễn (Annotation by Inference)</a></li>
          <li><a href="#ch-gii-tng-minh-explicit-annotation">Chú giải tường minh (Explicit Annotation)</a></li>
          <li><a href="#ch-gii-ni-tuyn-inline-annotation">Chú giải nội tuyến (Inline Annotation)</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#v-d-trc-quan-minh-ha-injection">Ví dụ trực quan minh họa Injection</a></li>
  <li><a href="#ti-liu-tham-kho">Tài liệu tham khảo</a></li>
</ul>

  </div>
</section>

<h2 id="dependency-injection-trong-angularjs">Dependency Injection trong AngularJS</h2>

<p>Như đã đề cập trong phần giới thiệu, hệ thống <em>Dependency Injection</em> trong <em>AngularJS</em> đã tạo thành xương sống của toàn bộ khung ứng dụng này. Phần bài viết này sẽ giải thích cách thức hoạt động của hệ thống <em>Dependency Injection</em> trong <em>AngularJS</em>.</p>

<h3 id="cc-thut-ng-quy-c">Các thuật ngữ quy ước</h3>

<ul>
  <li><strong>Inject</strong> (<em>bơm truyền</em>): khái niệm để chỉ hành động lấy giá trị hoặc tham chiếu của một đối tượng (giả sử là A), gán cho thuộc tính của một đối tượng khác (đối tượng B) theo một cách nào đó.</li>
  <li><strong>Injectable object</strong> (<em>đối tượng có thể bơm truyền được</em>): là những đối tượng được <em>AngularJS</em> tạo ra từ khai báo của người dùng, do <em>AngularJS</em> quản lý và có thể <em>bơm truyền</em> vào bên trong các hàm hoặc đối tượng khác.</li>
  <li><strong>Injected object</strong> (<em>đối tượng được bơm truyền</em>): là đối tượng có chứa một số chỗ đánh dấu (thường là tham số của hàm khởi tạo) để <em>AngularJS</em> có thể <em>bơm truyền</em> các <em>đối tượng có thể bơm truyền được</em> vào bên trong nó.</li>
  <li><strong>Provider</strong> (<em>đối tượng cung cấp</em>): là đối tượng do AngularJS tạo ra để chứa các định nghĩa về <em>đối tượng dịch vụ</em>. <em>AngularJS</em> cung cấp một số <em>provider</em> tạo sẵn cũng như cho phép nhà phát triển ứng dụng định nghĩa thêm các <em>provider</em> của riêng mình.</li>
  <li><strong>Service</strong> (<em>đối tượng dịch vụ</em>): khái niệm này được AngularJS sử dụng để nói đến những đối tượng do AngularJS tạo ra, quản lý, và có thể được <em>bơm truyền</em> vào cho những thành phần khác.</li>
  <li><strong>Instance of Service</strong> (<em>thể hiện của đối tượng dịch vụ</em>): khái niệm tương tự như <em>đối tượng dịch vụ</em> và được dùng lẫn lộn với khái niệm này trong AngularJS.</li>
</ul>

<p>Lưu ý: hầu hết các đối tượng do <em>AngularJS</em> tạo ra và quản lý đều vừa là <strong>Injectable object</strong> lẫn <strong>Injected object</strong>. Một số đối tượng, chẳng hạn thuộc loại <em>Value</em>, <em>Constant</em> thì chỉ có thể là <strong>Injectable object</strong>. Một số đối tượng như các <em>Directive</em> thì chỉ có thể là <strong>Injected object</strong>.</p>

<h3 id="cu-trc-dependency-injection-trong-angularjs">Cấu trúc Dependency Injection trong AngularJS</h3>

<p>Hai nhân tố cơ bản tạo dựng nên hệ thống <em>Dependency Injection</em> trong <em>AngularJS</em> chính là 2 đối tượng dịch vụ cơ bản trong <em>module auto</em>: <em>$provide</em> và <em>$injector</em>.</p>

<h4 id="i-tng-dch-v-provide">Đối tượng dịch vụ $provide</h4>

<p><img src="/blog/media/f973ec46-ece6-432b-a96f-46bd93f738e8/provide_diagram.png" alt="Sơ đồ hoạt động của $provide" /></p>

<p>Đối tượng dịch vụ <em>$provide</em> có nhiệm vụ <em>chỉ dẫn</em> cho AngularJS cách thức tạo ra các <em>đối tượng có thể bơm truyền được</em> (<em>injectable object</em>) - các đối tượng này còn được gọi là <em>đối tượng dịch vụ</em> của <em>AngularJS</em>. Những chỉ dẫn của <em>$provide</em> được “ghi lại” dưới dạng một loại đối tượng được gọi chung là <em>provider</em>. Định nghĩa <em>provider</em> được thực hiện thông qua hàm <em>provider()</em> của đối tượng dịch vụ <em>$provide</em>. Câu hỏi đặt ra là <em>$provide</em> từ đâu ra và làm thế nào để sử dụng nó? Câu trả lời rất đơn giản: <em>$provide</em> được <em>AngularJS</em> tạo ra khi khởi tạo ứng dụng và chúng ta có thể lấy nó ra bằng cách gọi hàm <em>config()</em> của <em>module</em>.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">myModule</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myApp&#39;</span><span class="p">,</span> <span class="p">[]);</span>
<span class="nx">myModule</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$provide</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$provide</span><span class="p">.</span><span class="nx">provider</span><span class="p">(</span><span class="s1">&#39;myProvider&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$get</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">};</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<p>Đoạn mã trên tạo ra một <em>provider</em> có tên là <em>myProvider</em>. Với <em>provider</em> này, AngularJS sẽ chịu trách nhiệm: tạo ra một <em>đối tượng dịch vụ</em> (<em>service</em>) bằng cách gọi hàm <em>$get()</em> định nghĩa bên trong <em>myProvider</em>; <em>bơm truyền</em> <em>service</em> vừa tạo này vào bất cứ <em>đối tượng có thể bơm truyền được</em> (chẳng hạn là một <em>Controller</em>). <em>Đối tượng có thể bơm truyền được</em> là những đối tượng được tạo ra từ một <em>provider</em> nào đó và chứa tham số có tên <em>myProvider</em> trong hàm định nghĩa <em>provider</em> của nó. Ví dụ sau minh họa cách <em>myProvider</em> được sử dụng:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">injector</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">injector</span><span class="p">([</span><span class="s1">&#39;myApp&#39;</span><span class="p">,</span> <span class="s1">&#39;ng&#39;</span><span class="p">]);</span>

<span class="c1">// injected object is a function</span>
<span class="kd">function</span> <span class="nx">myFunction</span><span class="p">(</span><span class="nx">myProvider</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">myProvider</span><span class="p">(</span><span class="s1">&#39;Hung&#39;</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">injector</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="nx">myFunction</span><span class="p">);</span> <span class="c1">// result contains 1</span>

<span class="c1">// injected object is a class</span>
<span class="kd">function</span> <span class="nx">myClass</span><span class="p">(</span><span class="nx">myProvider</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">myService</span> <span class="o">=</span> <span class="nx">myProvider</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sayHello</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
    <span class="k">this</span><span class="p">.</span><span class="nx">myService</span><span class="p">(</span><span class="s1">&#39;Hung&#39;</span><span class="p">);</span> 
  <span class="p">}</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">object</span> <span class="o">=</span> <span class="nx">injector</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="nx">myClass</span><span class="p">);</span>
<span class="nx">object</span><span class="p">.</span><span class="nx">sayHello</span><span class="p">();</span>

<span class="c1">// injected object is a controller</span>
<span class="nx">myModule</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;myController&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">myProvider</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">onClick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">myProvider</span><span class="p">(</span><span class="s1">&#39;Hung&#39;</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">});</span></code></pre></div>

<h5 id="hm-factory">Hàm factory()</h5>

<p>Để đơn giản hóa mã lệnh định nghĩa <em>provider</em> trong hàm <em>provider()</em>, AngularJS cung cấp hàm khai báo <em>factory()</em> là phiên bản giản lược của <em>provider()</em>, bằng cách giản lược <em>$provide.provider(‘myProvider’, function() { this.$get = function() { … }; });</em> thành <em>$provide.factory(‘myProvider’, function() { … });</em>. Với cách này, ta đã giảm bớt được một cấp khối lệnh trong khai báo. </p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">myModule</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$provide</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$provide</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;myProvider&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$window</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<p>Khai báo trên tương đương với khai báo đầy đủ sau:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">myModule</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$provide</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$provide</span><span class="p">.</span><span class="nx">provider</span><span class="p">(</span><span class="s1">&#39;myProvider&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$get</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$window</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">};</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<p>Để giản lược hơn nữa, AngularJS đã cung cấp thêm các hàm <em>provider()</em> và <em>factory()</em> trong đối tượng Module,  đơn giản hóa khai báo <em>myModule.config(function($provide) { $provide.factory( … ); });</em> thành khai báo <em>myModule.factory( … ); });</em>, nhờ đó các hàm khai báo trên sẽ được viết lại ngắn gọn hơn rất nhiều:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">myModule</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;myProvider&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$window</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">});</span>

<span class="nx">myModule</span><span class="p">.</span><span class="nx">provider</span><span class="p">(</span><span class="s1">&#39;myProvider&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">$get</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$window</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
    <span class="p">};</span>
  <span class="p">};</span>
<span class="p">});</span></code></pre></div>

<h5 id="hm-service">Hàm service()</h5>

<p>Hàm <em>service()</em> cho phép tạo ra đối tượng bằng cách sử dụng <em>hàm khai báo</em> làm <em>hàm khởi tạo đối tượng</em>. Giá trị trả lại của <em>service()</em> không phải là kết quả thực thi <em>hàm khai báo</em> như trong <em>factory()</em> mà là kết quả áp dụng toán tử <em>new</em> đối với hàm khai báo đó.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">myModule</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">&#39;myWallet&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$log</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">balance</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">checkBalance</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">balance</span><span class="p">;</span> <span class="p">};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">deposit</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">amount</span><span class="p">)</span> <span class="p">{</span> <span class="nx">balance</span> <span class="o">+=</span> <span class="nx">amount</span><span class="p">;</span> <span class="p">};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">withdraw</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">amount</span><span class="p">)</span> <span class="p">{</span> <span class="nx">balance</span> <span class="o">-=</span> <span class="nx">amount</span><span class="p">;</span> <span class="p">};</span>
<span class="p">});</span></code></pre></div>

<p>Hàm <em>service()</em> cũng là trường hợp đặc biệt của <em>provider()</em>. Ví dụ trên tương đương với khai báo sau: </p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">myModule</span><span class="p">.</span><span class="nx">provider</span><span class="p">(</span><span class="s1">&#39;myWallet&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">$get</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$log</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">balance</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">checkBalance</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">balance</span><span class="p">;</span> <span class="p">};</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">deposit</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">amount</span><span class="p">)</span> <span class="p">{</span> <span class="nx">balance</span> <span class="o">+=</span> <span class="nx">amount</span><span class="p">;</span> <span class="p">};</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">withdraw</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">amount</span><span class="p">)</span> <span class="p">{</span> <span class="nx">balance</span> <span class="o">-=</span> <span class="nx">amount</span><span class="p">;</span> <span class="p">};</span>
        <span class="p">}</span>
    <span class="p">}();</span>
  <span class="p">};</span>
<span class="p">});</span></code></pre></div>

<h5 id="hm-value">Hàm value()</h5>

<p>Trong trường hợp muốn khai báo với <em>AngularJS</em> đối tượng, hàm hoặc giá trị mà không cần (đôi khi chúng ta không muốn) <em>bơm truyền</em> các đối tượng phụ thuộc, khi đó sử dụng hàm <em>value()</em> để khai báo. </p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">myModule</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$provide</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$provide</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="s1">&#39;myValue&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<p>Khai báo trên tương đương với khai báo sau:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">myModule</span><span class="p">.</span><span class="nx">config</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$provide</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$provide</span><span class="p">.</span><span class="nx">provider</span><span class="p">(</span><span class="s1">&#39;myValue&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$get</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
      <span class="p">};</span>
    <span class="p">};</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<p>Phiên bản giản lược của khai báo này:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">myModule</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="s1">&#39;myValue&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>

<p>Như đã đề cập ở bên trên, <em>đối tượng dịch vụ</em> tạo ra từ hàm <em>value()</em> sẽ không thể <em>bơm truyền</em> bất cứ thứ gì vào cho nó được. Tại sao lại như vậy? là vì trong <em>AngularJS</em>, các tham số tiếp nhận giá trị <em>bơm truyền</em> đều phải nằm ở khai báo hàm <em>$get</em>. Khai báo của hàm <em>value()</em> sẽ nằm ở bên trong một hàm <em>$get</em> mà hàm <em>$get</em> này <em>AngularJS</em> đã định nghĩa cứng là không có tham số.</p>

<h4 id="i-tng-dch-v-injector">Đối tượng dịch vụ $injector</h4>

<p>Đối tượng dịch vụ <em>$injector</em> có nhiệm vụ tạo ra các <em>đối tượng thể hiện của dịch vụ</em> (<em>instances of services</em>) từ các khai báo <em>provider</em> được định nghĩa bởi <em>$provide</em>, đồng thời <em>bơm truyền</em> các <em>đối tượng dịch vụ</em> đã có vào cho <em>thể hiện của đối tượng dịch vụ</em> vừa mới tạo. Mỗi ứng dụng AngularJS có một đối tượng <em>$injector</em> được tự động tạo ra khi ứng dụng khởi động.</p>

<p><img src="/blog/media/f973ec46-ece6-432b-a96f-46bd93f738e8/injector_diagram.png" alt="Sơ đồ hoạt động của $injector" /></p>

<p>Làm thế nào để lấy đối tượng <em>$injector</em> tương ứng với một ứng dụng? Chúng ta sử dụng hàm <em>angular.injector()</em>, với các tham số là danh sách <em>module</em> của ứng dụng cần nạp.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// create an injector</span>
<span class="kd">var</span> <span class="nx">$injector</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">injector</span><span class="p">([</span><span class="s1">&#39;myApp&#39;</span><span class="p">,</span> <span class="s1">&#39;ng&#39;</span><span class="p">]);</span></code></pre></div>

<p>Giống như các <em>đối tượng dịch vụ</em> của AngularJS như: <em>$log</em>, <em>$window</em>,… và các <em>đối tượng dịch vụ</em> do chúng ta tạo ra, <em>$injector</em> có thể được <em>bơm truyền</em> vào bất cứ hàm nào muốn có đối tượng này để thao tác:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// $injector is an injectable object!</span>
<span class="nx">myModule</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;myController&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$scope</span><span class="p">,</span> <span class="nx">$injector</span><span class="p">,</span> <span class="nx">myProvider</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">$scope</span><span class="p">.</span><span class="nx">onClick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// do something with $injector</span>
    <span class="nx">myProvider</span><span class="p">(</span><span class="s2">&quot;AngularJS&#39;s users&quot;</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">});</span></code></pre></div>

<h5 id="hm-injectorget">Hàm $injector.get()</h5>

<p>Khi đã có đối tượng <em>$injector</em>, chúng ta có thể lấy đối tượng thể hiện của các <em>service</em> đã được khai báo trước đó bằng cách sử dụng hàm <em>$injector.get()</em>. Nếu là lần đầu gọi đến, đối tượng thể hiện sẽ được <em>$injector</em> tạo mới, lưu lại và trả tham chiếu về cho người dùng. Trong những lần gọi <em>thể hiện của đối tượng dịch vụ</em> đó tiếp theo, <em>$injector.get()</em> sẽ tìm trong danh sách có sẵn và trả về tham chiếu đến đối tượng có sẵn cho người dùng. Như vậy, 2 lần gọi liên tiếp của hàm <em>$injector.get()</em> sẽ cho ra cùng một <em>thể hiện của đối tượng dịch vụ</em>.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myApp&#39;</span><span class="p">,</span> <span class="p">[]);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">service</span><span class="p">(</span><span class="s1">&#39;myWallet&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">balance</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">checkBalance</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">balance</span><span class="p">;</span> <span class="p">};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">deposit</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">amount</span><span class="p">)</span> <span class="p">{</span> <span class="nx">balance</span> <span class="o">+=</span> <span class="nx">amount</span><span class="p">;</span> <span class="p">};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">withdraw</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">amount</span><span class="p">)</span> <span class="p">{</span> <span class="nx">balance</span> <span class="o">-=</span> <span class="nx">amount</span><span class="p">;</span> <span class="p">};</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">injector</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">injector</span><span class="p">([</span><span class="s1">&#39;myApp&#39;</span><span class="p">,</span> <span class="s1">&#39;ng&#39;</span><span class="p">]);</span>

<span class="kd">var</span> <span class="nx">wallet1</span> <span class="o">=</span> <span class="nx">injector</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;myWallet&#39;</span><span class="p">);</span>
<span class="nx">wallet1</span><span class="p">.</span><span class="nx">deposit</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
<span class="nx">alert</span><span class="p">(</span><span class="nx">wallet1</span><span class="p">.</span><span class="nx">checkBalance</span><span class="p">());</span> <span class="c1">// will display 20</span>

<span class="kd">var</span> <span class="nx">wallet2</span> <span class="o">=</span> <span class="nx">injector</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;myWallet&#39;</span><span class="p">);</span>
<span class="nx">wallet2</span><span class="p">.</span><span class="nx">withdraw</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="nx">alert</span><span class="p">(</span><span class="nx">wallet2</span><span class="p">.</span><span class="nx">checkBalance</span><span class="p">());</span> <span class="c1">// will display 15</span></code></pre></div>

<h5 id="hm-injectorinvoke">Hàm $injector.invoke()</h5>

<p>Đối tượng dịch vụ <em>$injector</em> còn có khả năng <em>bơm truyền</em> các <em>thể hiện của đối tượng dịch vụ</em> của <em>AngularJS</em> cho các hàm bên ngoài thông qua hàm <em>$injector.invoke()</em>. Ví dụ minh họa đã được trình bày trong phần “Đối tượng dịch vụ $provide” ở bên trên, ở đây chỉ xin nhắc lại:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">myModule</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myApp&#39;</span><span class="p">,</span> <span class="p">[]);</span>

<span class="nx">myModule</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;myProvider&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">injector</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">injector</span><span class="p">([</span><span class="s1">&#39;myApp&#39;</span><span class="p">,</span> <span class="s1">&#39;ng&#39;</span><span class="p">]);</span>

<span class="c1">// injectable thing is a function</span>
<span class="kd">function</span> <span class="nx">myFunction</span><span class="p">(</span><span class="nx">myProvider</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">myProvider</span><span class="p">(</span><span class="s1">&#39;Hung&#39;</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">injector</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="nx">myFunction</span><span class="p">);</span> <span class="c1">// result contains 1</span></code></pre></div>

<p>Rõ ràng là chúng ta có thể <em>bơm truyền</em> các <em>thể hiện của đối tượng dịch vụ</em> vào bên trong bất cứ hàm nào được kích hoạt bởi <em>$injector.invoke()</em>. Các hàm định nghĩa trong <em>AngularJS</em> được kích hoạt bằng <em>$injector.invoke()</em> (ngầm định bởi AngularJS) cũng có khả năng được <em>bơm truyền</em>. Các hàm này bao gồm:</p>

<ul>
  <li>Các hàm định nghĩa <em>controller</em></li>
  <li>Các hàm định nghĩa <em>directive</em></li>
  <li>Các hàm định nghĩa <em>filter</em></li>
  <li>Các hàm định nghĩa <em>factory</em></li>
  <li>Các hàm định nghĩa <em>service</em></li>
  <li>Các hàm <em>$get</em> trong định nghĩa <em>provider</em></li>
</ul>

<p>Hàm khai báo <em>value</em> luôn trả lại một giá trị tĩnh (<em>static value</em>), do đó chúng không được kích hoạt thông qua <em>$injector.invoke()</em>, do đó không thể <em>bơm truyền</em> bất cứ thứ gì vào cho chúng.</p>

<h3 id="ch-gii-ph-thuc-dependency-annotation">Chú giải phụ thuộc (Dependency Annotation)</h3>

<p>Trong tất cả các ví dụ minh họa ở trên, chúng ta đều quy ước các tham số muốn được <em>bơm truyền</em> <em>thể hiện của đối tượng dịch vụ</em> đều phải có tên trùng với tên khai báo <em>provider</em> của <em>service</em> đó. Việc đặt tên tham số tiếp nhận <em>injection</em> trùng với tên <em>provider</em> là để chỉ chỗ (một cách “ngầm hiểu” với nhau) cho <em>AngularJS</em> rằng tôi muốn được <em>bơm truyền</em> <em>đối tượng dịch vụ</em> ứng với <em>provider</em> trùng tên vào chỗ này đây. Những quy định về cách đặt tên nhằm chỉ chỗ cho AngularJS biết chỗ để <em>bơm truyền</em> được gọi là <em>chú giải phụ thuộc</em>. <em>AngularJS</em> hỗ trợ 3 cách chú giải khác nhau nhằm giúp cho người lập trình có sự lựa chọn phù hợp trong quá trình viết ứng dụng.</p>

<h4 id="ch-gii-suy-din-annotation-by-inference">Chú giải suy diễn (Annotation by Inference)</h4>

<p><em>AngularJS</em> giả định rằng nếu không có khai báo nào khác, thì tên tham số của <em>hàm cấu tạo đối tượng</em> (constructor) chính là tên của <em>dependency</em>. Do đó, nó sẽ phân tích và trích rút tên của các tham số của <em>hàm cấu tạo đối tượng</em>, sau đó sử dụng <em>$injector</em> để xác định các <em>dependency</em> có tên ở trên, rồi “truyền” (inject) các <em>dependency</em> này vào các tham số tương ứng trong lời gọi hàm khi khởi tạo đối tượng.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// using annotation by inference</span>
<span class="nx">myModule</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;myActivity&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$http</span><span class="p">,</span> <span class="nx">myProvider</span><span class="p">,</span> <span class="nx">myWallet</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// do something with $http</span>
    <span class="nx">myWallet</span><span class="p">.</span><span class="nx">deposit</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
    <span class="nx">myProvider</span><span class="p">(</span><span class="nx">myWallet</span><span class="p">.</span><span class="nx">checkBalance</span><span class="p">());</span>
  <span class="p">};</span>
<span class="p">});</span></code></pre></div>

<p>Lưu ý: Do sử dụng tên đầy đủ của tham số như là tên của <em>dependency</em> cần xác định, nên chú giải suy diễn chỉ làm việc với mã lệnh chưa bị tối giản (non-minified), chưa bị làm rối (non-obfuscated). Tại sao như vậy? lý do rất đơn giản là các bộ tối giản mã (JavaScript Minifier) hoặc làm rối mã (Javascript Obfuscator) đều tự động đổi tên các tham số của hàm sao cho tên những tham số có số lượng ký tự tối thiểu (thường chỉ có 1-2 ký tự), trong khi tên của <em>dependency</em> không bị đổi hoặc bị đổi thành một chuỗi khác.</p>

<p>Do hạn chế không thể sử dụng khi mã nguồn được tối giản nên <em>chú giải suy diễn</em> chỉ được sử dụng trong trường hợp viết mã lệnh nhanh, không cần tối ưu như viết ví dụ minh họa, lập trình các ứng dụng nhỏ không cần tối giản mã lệnh.</p>

<h4 id="ch-gii-tng-minh-explicit-annotation">Chú giải tường minh (Explicit Annotation)</h4>

<p><em>AngularJS</em> cung cấp cho chúng ta một phương thức để xác định tường minh các <em>dependency</em> cần dùng đến khi  gọi một hàm khởi tạo: khai báo thuộc tính <em>$inject</em> của hàm khởi tạo, chứa danh sách tên các <em>dependency</em>. Quá trình xử lý <em>Dependency Injection</em> sẽ sử dụng thuộc tính chú giải <em>$inject</em> để xác định các <em>dependency</em> cần cung cấp cho lời gọi hàm khởi tạo đối tượng. </p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// using explicit annotation</span>
<span class="kd">var</span> <span class="nx">myActivityFactory</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhttp</span><span class="p">,</span> <span class="nx">varProvider</span><span class="p">,</span> <span class="nx">varWallet</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// do something with xhttp</span>
    <span class="nx">varWallet</span><span class="p">.</span><span class="nx">deposit</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
    <span class="nx">varProvider</span><span class="p">(</span><span class="nx">varWallet</span><span class="p">.</span><span class="nx">checkBalance</span><span class="p">());</span>
  <span class="p">};</span>
<span class="p">};</span>
<span class="nx">myActivityFactory</span><span class="p">.</span><span class="nx">$inject</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$http&#39;</span><span class="p">,</span> <span class="s1">&#39;myProvider&#39;</span><span class="p">,</span> <span class="s1">&#39;myWallet&#39;</span><span class="p">];</span>
<span class="nx">myModule</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;myActivity&#39;</span><span class="p">,</span> <span class="nx">myActivityFactory</span><span class="p">);</span></code></pre></div>

<p>Phương thức này cho phép các bộ tối giản mã hoặc các bộ làm rối mã có thể đổi tên các tham số của các hàm mà vẫn đảm bảo xác định đúng và truyền chính xác các <em>dependency</em> cho các hàm đó.</p>

<h4 id="ch-gii-ni-tuyn-inline-annotation">Chú giải nội tuyến (Inline Annotation)</h4>

<p>Phương thức chú giải thứ ba mà <em>AngularJS</em> cung cấp cho chúng ta chính là <em>chú giải nội tuyến</em> (<em>Inline Annotation</em>). Cách hoạt động của loại chú giải này cũng giống với <em>chú giải tường minh</em>, tuy nhiên nó cho phép khai báo danh sách tên <em>dependency</em> nội tuyến bên trong định nghĩa hàm khởi tạo. </p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// using inline annotation</span>
<span class="nx">myModule</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;myActivity&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$http&#39;</span><span class="p">,</span> <span class="s1">&#39;myProvider&#39;</span><span class="p">,</span> <span class="s1">&#39;myWallet&#39;</span><span class="p">,</span> 
  <span class="kd">function</span><span class="p">(</span><span class="nx">xhttp</span><span class="p">,</span> <span class="nx">varProvider</span><span class="p">,</span> <span class="nx">varWallet</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// do something with xhttp</span>
      <span class="nx">varWallet</span><span class="p">.</span><span class="nx">deposit</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
      <span class="nx">varProvider</span><span class="p">(</span><span class="nx">varWallet</span><span class="p">.</span><span class="nx">checkBalance</span><span class="p">());</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">]);</span></code></pre></div>

<p>Về mặt cú pháp, <em>chú giải nội tuyến</em> cho phép truyền một mảng thay vì một hàm trong phần khai báo hàm khởi tạo đối tượng của <em>AngularJS</em>. Các phần tử của mảng là danh sách tên của các <em>dependency</em> cần truyền cho tham số hàm khởi tạo, phần tử cuối của mảng chính là khai báo hàm khởi tạo đối tượng. Cách khai báo này giúp chúng ta tránh được việc sử dụng thêm một thuộc tính trong việc khai báo hàm khởi tạo.</p>

<h2 id="v-d-trc-quan-minh-ha-injection">Ví dụ trực quan minh họa Injection</h2>

<p>Nếu có sự so sánh giữa <em>Dependency Injection</em> trong lập trình với Injection trong y tế (Medical Injection), chúng ta sẽ thấy có sự tương đồng khá thú vị. Phần này sẽ trình bày một ví dụ nhỏ, minh họa cho sự tương đồng đó.</p>

<p>Giả sử có một bệnh nhân (<em>patient</em>), được điều trị tại bệnh viện (<em>hospital</em>). Anh ta tham gia vào một quá trình điều trị (<em>treatment</em>), trong đó được điều dưỡng (<em>nurse</em>) tiêm 2 loại vacxin tên là <em>vaccineX</em> và <em>vaccineY</em>. <em>vaccineX</em> có tác dụng điều trị căn bệnh <em>X</em> của anh ta, còn <em>vaccineY</em> có chức năng ngăn ngừa căn bệnh <em>Y</em>. Khi đó, quá trình thực hiện này có thể được minh họa thông qua đoạn chương trình sau:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">$hospital</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;Hospital&#39;</span><span class="p">,</span> <span class="p">[]);</span>

<span class="nx">$hospital</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;vaccineX&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$window</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">isInjected</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;The VaccineX was injected into patient &quot;</span> <span class="o">+</span>
          <span class="s2">&quot;to cure the disease X.&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">});</span>

<span class="nx">$hospital</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;vaccineY&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$window</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">isInjected</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$window</span><span class="p">.</span><span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;The VaccineY was injected into patient &quot;</span> <span class="o">+</span>
          <span class="s2">&quot;to prevent the disease Y.&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
<span class="p">});</span>

<span class="nx">$hospital</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;patient&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;vaccineX&#39;</span><span class="p">,</span> <span class="s1">&#39;vaccineY&#39;</span><span class="p">,</span> 
    <span class="kd">function</span><span class="p">(</span><span class="nx">biceps</span><span class="p">,</span> <span class="nx">buttock</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="nx">treat</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">biceps</span><span class="p">.</span><span class="nx">isInjected</span><span class="p">();</span>
                <span class="nx">buttock</span><span class="p">.</span><span class="nx">isInjected</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">]);</span>

<span class="kd">var</span> <span class="nx">$nurse</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">injector</span><span class="p">([</span><span class="s1">&#39;Hospital&#39;</span><span class="p">,</span> <span class="s1">&#39;ng&#39;</span><span class="p">]);</span>

<span class="kd">var</span> <span class="nx">Treatment</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">patient</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">patient</span><span class="p">.</span><span class="nx">treat</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">$nurse</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="nx">Treatment</span><span class="p">);</span></code></pre></div>

<p>Đoạn mã lệnh trên có thể minh họa trực quan bằng hình vẽ bên dưới. Đối chiếu hình vẽ và mã lệnh bên trên, bạn thấy <em>Dependency Injection</em> còn khó hiểu nữa hay không?</p>

<p><img src="/blog/media/f973ec46-ece6-432b-a96f-46bd93f738e8/dependency_injection_demo_diagram.png" alt="Sơ đồ minh họa trực quan khái niệm Injection" /></p>

<h2 id="ti-liu-tham-kho">Tài liệu tham khảo</h2>

<ul>
  <li><a href="https://docs.angularjs.org/guide">AngularJS’s Development Guide</a></li>
  <li><a href="https://docs.angularjs.org/api">AngularJS’s API Reference</a></li>
  <li><a href="https://github.com/angular/angular.js/wiki/Understanding-Dependency-Injection">Understanding Dependency Injection - AngularJS’s wiki</a> </li>
  <li><a href="http://stackoverflow.com/questions/15666048/service-vs-provider-vs-factory">Service vs provider vs factory? - StackOverflow</a></li>
  <li><a href="http://tylermcginnis.com/angularjs-factory-vs-service-vs-provider/">AngularJS: Factory vs Service vs Provider</a></li>
</ul>


            </div>
        </article>

        <div class="cf"></div>
        <div class="row text-center">
            <section class="cheryk-post-share">
                <a class="twitter-icon" href="https://twitter.com/intent/tweet?text=&quot;Tổng quan về Dependency Injection trong AngularJS (P2)&quot;%20/blog/javascript/angularjs/tong-quan-ve-dependency-injection-trong-angularjs-p2.html%20via%20&#64;pnhung177"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
                    <i class="fa fa-twitter"></i>
                </a>
                <a class="facebook-icon" href="https://www.facebook.com/sharer/sharer.php?u=/blog/javascript/angularjs/tong-quan-ve-dependency-injection-trong-angularjs-p2.html"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
                    <i class="fa fa-facebook"></i>
                </a>
                <a class="google-icon" href="https://plus.google.com/share?url=/blog/javascript/angularjs/tong-quan-ve-dependency-injection-trong-angularjs-p2.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title="Share on Google+">
                    <i class="fa fa-google-plus"></i>
                </a>
            </section>
        </div>
        <div class="cf"></div>
            <div class="cheryk-author-info">
                <div class="row">
                    <section class="cheryk-post-author small-12 columns">
                        
                            <img src="/blog/images/avatars/pnhung177.png" class="cheryk-post-author-avatar" alt="Phạm Ngọc Hùng's photo">
                        
                            <span class="author-label">Author</span>
                            <h1>Phạm Ngọc Hùng</h1>
                        
                            <p><a href="mailto:pnhung177@drupalex.net" class="author-website">pnhung177@drupalex.net</a></p>
                        
                            <p>... when the sun comes up, you better be running!</p>
                        
                    </section>
                </div>
            </div> 
        <div class="cf"></div>

        
        <section class="cheryk-disqus row">
    <div class="small-12 columns">
        <h1 class="cheryk-comments-header">Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'acegik'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
</section>

         
</main> 


<div class="cf"></div>
<footer class="cheryk-site-footer">
    <div class="copyright">
         <section>Bản quyền nội dung thuộc về <a href="/blog/about">Phạm Ngọc Hùng</a> &copy; 2015.</section>
    </div>
    <div class="social-icons">
        
        
        <a href="http://twitter.com/pnhung177">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-twitter fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="https://plus.google.com/u/3/115458186421626071505">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-google-plus fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="http://github.com/pnhung177">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-github fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="http://facebook.com/pnhung177">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-facebook fa-stack-1x"></i>
            </span>
        </a>
        
    </div>
    
    <div class="cf"></div>
</footer>

<script src="/blog/assets/js/vendor/modernizr.js"></script>
<script src="/blog/assets/js/foundation.min.js"></script>
<script src="/blog/assets/js/vendor/background-check.js"></script>
<script src="/blog/assets/js/vendor/post-header-animations.js"></script>
<script src="/blog/assets/js/main.js"></script>

<script>
  $(document).foundation();
</script>



<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54128248-1', 'auto');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');

</script>


  
</body>
</html>
