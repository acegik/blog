<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>KIểM THử đơN Vị (UNIT TESTING) TRONG ANGULARJS &vert; ACEGIK'S BLOG</title>
<meta name="description" content="... when the sun comes up, you better be running!">
<meta name="keywords" content="JavaScript, AngularJS">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/blog/images/logo.png">
<meta name="twitter:title" content="Kiểm thử đơn vị (Unit Testing) trong AngularJS">
<meta name="twitter:description" content="... when the sun comes up, you better be running!">
<meta name="twitter:creator" content="@pnhung177">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Kiểm thử đơn vị (Unit Testing) trong AngularJS">
<meta property="og:description" content="... when the sun comes up, you better be running!">
<meta property="og:url" content="/blog/javascript/angularjs/kiem-thu-don-vi-unit-testing-trong-angularjs.html">
<meta property="og:site_name" content="Acegik's Blog">
<meta property="og:image" content="/blog/images/">





<link rel="canonical" href="/blog/javascript/angularjs/kiem-thu-don-vi-unit-testing-trong-angularjs.html">
<link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="Acegik's Blog Feed">
<link rel="author" href="https://plus.google.com/u/3/115458186421626071505?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700|Open+Sans:400,600,300,800,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="/blog/assets/css/font-awesome.min.css">
<link rel="stylesheet" href="/blog/assets/css/vendor/normalize.css">
<link rel="stylesheet" href="/blog/assets/css/vendor/foundation.min.css">
<link rel="stylesheet" href="/blog/assets/css/style.css">
<link rel="stylesheet" href="/blog/assets/css/post.css">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/blog/assets/js/vendor/jquery-1.11.1.min.js"><\/script>')</script>





<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/blog/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/blog/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/blog/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/blog/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/blog/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/blog/images/apple-touch-icon-144x144-precomposed.png">

</head>
<body class="post-template" itemscope itemtype="http://schema.org/WebPage">


        <main id="cheryk-post-container-simple" class="cheryk-post-container-simple" role="main">
            <header class="cheryk-post-header-simple">
                <div class="cheryk-post-menu-header-simple">

                    <a class="cheryk-blog-logo" href="/blog">
                        <img src="/blog/images/logo.png" alt="Blog Logo" />
                    </a>

                <div class="cheryk-blog-menu">      
    <div class="cheryk-mobile-menu show-for-small">
        <a href="#"><i class="fa fa-bars"></i></a>
    </div>
    <ul class="cheryk-menu">
        <li class="cheryk-mobile-close-btn show-for-small text-right">
            <a href="#"><i class="fa fa-times"></i></a>
        </li>

            <li>
                    <a href="/blog/">Trang bìa</a>
                 </li>

            <li>
                    <a href="/blog/featured">Danh sách</a>
                 </li>

            <li>
                    <a href="/blog/categories">Phân loại</a>
                 </li>

            <li>
                    <a href="/blog/about">Giới thiệu</a>
                 </li>
            
           <li><a href="/blog/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
    </ul>

</div>
            </div>

                <div class="cheryk-post-title-simple row">
                    <div class="small-12 columns">
                        <div class="cheryk-post-meta-simple">
                            <h1>Kiểm thử đơn vị (Unit Testing) trong AngularJS</h1>
                            <p>by <strong>pnhung177</strong> &#8212; on <a href="/blog/tags/index.html#JavaScript" data-toggle="tooltip" title="Posts tagged with JavaScript" rel="tag">JavaScript</a>&nbsp;&comma;&nbsp;<a href="/blog/tags/index.html#AngularJS" data-toggle="tooltip" title="Posts tagged with AngularJS" rel="tag">AngularJS</a> &#8212; <strong><time datetime="2014-11-21T00:00:00+07:00">21/11/2014</time></strong></p>
                        </div>
                    </div>
                </div>
            </header>

        <article class="cheryk-post-content post tag-simple">
            <div><p>Trong bài viết trước, tôi đã cố gắng trình bày về tầm quan trọng của Kiểm thử đơn vị (Unit testing) trong phát triển ứng dụng nói chung cũng như các ứng dụng trong AngularJS nói riêng. Bài viết này hướng dẫn từng bước cách tạo môi trường để thực hiện Kiểm thử đơn vị trong AngularJS cũng như giải thích về các kỹ thuật thường áp dụng thông qua các ví dụ đơn giản.</p>

<section>
  <header>
    <h2>Nội dung trình bày</h2>
  </header>
<div id="drawer">
<ul id="markdown-toc">
  <li><a href="#thit-lp-mi-trng-unit-testing">Thiết lập môi trường Unit Testing</a>    <ul>
      <li><a href="#karma---mi-trng--chy-unit-testing">Karma - môi trường để chạy Unit Testing</a>        <ul>
          <li><a href="#ci-t-nodejs">Cài đặt Node.js</a></li>
          <li><a href="#ci-t-karma">Cài đặt Karma</a></li>
          <li><a href="#ci-t-karma-commandline-interface">Cài đặt Karma Commandline Interface</a></li>
          <li><a href="#tp-cu-hnh-ca-karma">Tệp cấu hình của Karma</a></li>
        </ul>
      </li>
      <li><a href="#jasmine---khung-ng-dng-cho-unit-testing">Jasmine - khung ứng dụng cho Unit Testing</a>        <ul>
          <li><a href="#khai-bo-spec-suite">Khai báo Spec Suite</a></li>
          <li><a href="#khai-bo-hm-kim-th-spec">Khai báo hàm kiểm thử (Spec)</a></li>
          <li><a href="#cc-hm-khi-to-v-thu-dn-mi-trng">Các hàm khởi tạo và thu dọn môi trường</a></li>
          <li><a href="#cc-hm-k-vng-expectations">Các hàm kỳ vọng (Expectations)</a></li>
        </ul>
      </li>
      <li><a href="#v-d-n-gin-v-unit-testing">Ví dụ đơn giản về Unit Testing</a></li>
    </ul>
  </li>
  <li><a href="#p-dng-unit-testing-cho-ng-dng-angularjs">Áp dụng Unit Testing cho ứng dụng AngularJS</a>    <ul>
      <li><a href="#k-thut-gi-lp-trong-kim-th-angularjs">Kỹ thuật giả lập trong kiểm thử AngularJS</a>        <ul>
          <li><a href="#khai-bo-th-vin-angular-mocks">Khai báo thư viện angular-mocks</a></li>
          <li><a href="#gi-lp-module-ng-dng-c-kim-th">Giả lập module ứng dụng được kiểm thử</a></li>
          <li><a href="#thay-th-cc-dch-v-ph-thuc">Thay thế các dịch vụ phụ thuộc</a></li>
          <li><a href="#ch-nh-dch-v-cn-s-dng">Chỉ định dịch vụ cần sử dụng</a></li>
        </ul>
      </li>
      <li><a href="#p-dng-unit-testing-cho-cc-controller">Áp dụng Unit Testing cho các Controller</a>        <ul>
          <li><a href="#ti-v-d-minh-ha">Tải ví dụ minh họa</a></li>
          <li><a href="#m-t-controller-cn-kim-th">Mô tả Controller cần kiểm thử</a></li>
          <li><a href="#to-spec-kim-th-controller">Tạo Spec kiểm thử Controller</a></li>
          <li><a href="#ci-tin-cch-kim-th">Cải tiến cách kiểm thử</a></li>
        </ul>
      </li>
      <li><a href="#p-dng-unit-testing-cho-cc-service">Áp dụng Unit Testing cho các Service</a>        <ul>
          <li><a href="#ti-v-d-minh-ha-1">Tải ví dụ minh họa</a></li>
          <li><a href="#m-t-service-cn-kim-th">Mô tả Service cần kiểm thử</a></li>
          <li><a href="#to-spec-kim-th-service">Tạo Spec kiểm thử Service</a></li>
        </ul>
      </li>
      <li><a href="#p-dng-unit-testing-cho-cc-filter">Áp dụng Unit Testing cho các Filter</a>        <ul>
          <li><a href="#ti-v-d-minh-ha-2">Tải ví dụ minh họa</a></li>
          <li><a href="#m-t-filter-cn-kim-th">Mô tả Filter cần kiểm thử</a></li>
          <li><a href="#to-spec-kim-th-filter">Tạo Spec kiểm thử Filter</a></li>
        </ul>
      </li>
      <li><a href="#p-dng-unit-testing-cho-cc-directive">Áp dụng Unit Testing cho các Directive</a>        <ul>
          <li><a href="#ti-v-d-minh-ha-3">Tải ví dụ minh họa</a></li>
          <li><a href="#m-t-directive-cn-kim-th">Mô tả Directive cần kiểm thử</a></li>
          <li><a href="#to-spec-kim-th-directive">Tạo Spec kiểm thử Directive</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#ti-liu-tham-kho">Tài liệu tham khảo</a></li>
</ul>

  </div>
</section>

<h2 id="thit-lp-mi-trng-unit-testing">Thiết lập môi trường Unit Testing</h2>

<h3 id="karma---mi-trng--chy-unit-testing">Karma - môi trường để chạy Unit Testing</h3>

<p>(Vai trò của Karma đối với việc Kiểm thử trong AngularJS cũng giống như nền móng và mặt bằng xung quanh của một ngôi nhà)</p>

<h4 id="ci-t-nodejs">Cài đặt Node.js</h4>

<p>Các bạn có thể tham khảo hướng dẫn cài đặt Node.js tại <a href="https://github.com/joyent/node/wiki/Installing-Node.js-via-package-manager">trang hướng dẫn này</a>.</p>

<h4 id="ci-t-karma">Cài đặt Karma</h4>

<p>Dưới đây tôi chỉ ghi chép lại các bước cài đặt mà tôi đã thực hiện trên Ubuntu. Đối với các hệ điều hành khác, các bạn vui lòng tham khảo trên Internet. Trừ khi sử dụng <strong>nvm</strong> (<a href="https://github.com/creationix/nvm">Node Version Manager</a>), các bạn chỉ nên cài đặt karma ở chế độ <strong>local</strong> (không dùng tham số -g): Karma và tất cả plugin liên quan đều được cài đặt trong thư mục <strong>node_modules</strong> bên trong thư mục gốc của dự án.</p>

<p>Về cơ bản, chúng ta cần các gói thư viện <strong>karma</strong>, <strong>karma-jasmine</strong> và <strong>karma-chrome-launcher</strong> (hoặc <strong>karma-firefox-launcher</strong> nếu bạn muốn chạy với Firefox) , các thư viện phụ thuộc sẽ được <strong>npm</strong> tự động tìm và cài đặt:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>npm install karma --save-dev</code></pre></div>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>npm install karma-jasmine karma-chrome-launcher --save-dev</code></pre></div>

<p>Tham số <strong>–save-dev</strong> lưu thông tin của karma vào khai báo <strong>devDependencies</strong> trong tệp <strong>package.json</strong>.</p>

<p>Sau khi cài đặt xong, chạy thử Karma như sau:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>./node_modules/karma/bin/karma start</code></pre></div>

<h4 id="ci-t-karma-commandline-interface">Cài đặt Karma Commandline Interface</h4>

<p>Để tránh mỗi lần muốn chạy Karma, người dùng phải gõ lệnh <strong>./node_modules/karma/bin/karma start</strong> dài và nhàm chán, chúng ta cài đặt Karma Commandline Interface (lưu ý các tham số -g):</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>npm install -g karma-cli</code></pre></div>

<p>Sau đó, mỗi lần muốn chạy Karma, chúng ta chỉ cần sử dụng lệnh ngắn gọn, chẳng hạn <strong>karma start</strong>. <strong>karma-cli</strong> sẽ tự động tìm ứng dụng karma tại thư mục đang làm việc (tức là <strong>./node_modules/karma/bin/karma</strong>) để thực thi.</p>

<h4 id="tp-cu-hnh-ca-karma">Tệp cấu hình của Karma</h4>

<p>Karma cho phép người dùng tùy chỉnh môi trường cho các dạng kiểm thử khác nhau, bằng cách cung cấp lệnh để người dùng khai báo các tham số môi trường. Các khai báo tham số môi trường kiểm thử sẽ được lưu trong một tệp cấu hình. Thông thường, người lập trình sẽ khai báo tham số và lưu vào tệp cấu hình môi trường cho mỗi loại kiểm thử trong AngularJS, chẳng hạn karma-unit.conf.js cho Unit Testing, karma-e2e.conf.js cho End-to-End Testing.</p>

<p>Để thuận tiện cho việc khai báo, Karma cung cấp lệnh <strong>karma init &lt;tên tệp cấu hình&gt;</strong> để người dùng chọn giá trị cho từng mục cấu hình. Chẳng hạn, để tạo tệp cấu hình cho Unit Testing, chúng ta chuyển thư mục làm việc vào thư mục gốc của dự án, dùng lệnh khởi tạo như sau:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>karma init karma-unit.conf.js</code></pre></div>

<p>(Lưu ý chỉ tạo tệp cấu hình sau khi đã cài đặt <strong>karma</strong> và các gói thư viện liên quan vào thư mục gốc của dự án như hướng dẫn ở bên trên).</p>

<h3 id="jasmine---khung-ng-dng-cho-unit-testing">Jasmine - khung ứng dụng cho Unit Testing</h3>

<p>(Vai trò của Jasmine đối với việc Kiểm thử trong AngularJS cũng giống như khung bê-tông, dầm trụ xi-măng của một ngôi nhà)</p>

<p>Jasmine là khung ứng dụng hỗ trợ kiểm thử theo mô hình BDD (Behavior-Driven Development framework). Jasmine được chọn mặc định làm khung ứng dụng kiểm thử trong Karma. Để sử dụng Jasmine với Karma, chúng ta cần cài đặt gói thư viện <strong>karma-jasmine</strong> (như đã thực hiện trong phần cài đặt Karma ở bên trên).</p>

<p>Jasmine cung cấp nhiều hàm tiện ích hỗ trợ các khía cạnh khác nhau trong kiểm thử. Phần dưới đây sẽ trình bày các nhóm hàm hỗ trợ kiểm thử thường dùng của Jasmine.</p>

<h4 id="khai-bo-spec-suite">Khai báo Spec Suite</h4>

<p><strong>Spec Suite</strong> là một <em>bộ mô tả kiểm thử</em>, bao gồm nhiều hàm kiểm thử, mỗi hàm kiểm thử tập trung vào một khía cạnh cần kiểm tra của một đơn vị chương trình. Các hàm kiểm thử trong <strong>Spec Suite</strong> thường có chung đơn vị chương trình nên có môi trường thử nghiệm giống nhau, do đó <strong>Spec Suite</strong> chứa các <em>hàm khởi tạo</em> và các <em>hàm thu dọn</em> môi trường chung cho các hàm kiểm thử đó. <strong>Spec Suite</strong> được định nghĩa bởi hàm <strong>describe()</strong>:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Spec Suite: myController&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    
    <span class="c1">// các hàm khởi tạo, thu dọn môi trường</span>

    <span class="c1">// các hàm kiểm thử từng khía cạnh của đơn vị chương trình</span>
<span class="p">});</span></code></pre></div>

<p>Chúng ta có thể phân nhỏ các <strong>Spec Suite</strong> bằng cách định nghĩa các <strong>Spec Suite</strong> lồng nhau:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Spec Suite: myController&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    
    <span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Sub Spec Suite: create function&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">});</span>
    
    <span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Sub Spec Suite: update function&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<h4 id="khai-bo-hm-kim-th-spec">Khai báo hàm kiểm thử (Spec)</h4>

<p>Trong Jasmine, mỗi <em>hàm kiểm thử</em> được gọi là một <strong>Spec</strong>. Jasmine cung cấp hàm <strong>it()</strong> để định nghĩa <strong>Spec</strong>.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Spec Suite: a very simple Spec&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;contains a passing spec&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">expect</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<h4 id="cc-hm-khi-to-v-thu-dn-mi-trng">Các hàm khởi tạo và thu dọn môi trường</h4>

<p>Để thiết lập môi trường kiểm thử cho các <strong>Spec</strong>, Jasmine cung cấp hàm <strong>beforeEach()</strong> cho phép khai báo đoạn mã lệnh sẽ được chạy ngay trước khi thực hiện mỗi <strong>Spec</strong>. Cụ thể, <strong>beforeEach()</strong> thường được dùng để giả lập các Service mà đối tượng được kiểm thử cần dùng đến, xác lập trạng thái ban đầu của đối tượng,v.v.. Hàm <strong>beforeEach()</strong> được định nghĩa như sau:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Spec Suite: myController&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    
    <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// setup something before running each Spec ...</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<p>Tương tự như vậy, Jasmine cung cấp hàm <strong>afterEach()</strong> để khai báo hàm sẽ được chạy ngay sau khi thực hiện từng <strong>Spec</strong>:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Spec Suite: myController&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    
    <span class="nx">afterEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// reset environment after running each Spec ...</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<h4 id="cc-hm-k-vng-expectations">Các hàm kỳ vọng (Expectations)</h4>

<p>Các hàm kỳ vọng cho phép chúng ta khẳng định <em>một biểu thức cần kiểm thử</em> phải có giá trị <em>thỏa mãn</em> một <em>yêu cầu</em> nào đó.</p>

<ul>
  <li><em>expect(x).toEqual(val)</em>: Khẳng định giá trị của đối tượng <strong>x</strong> bằng với <strong>val</strong> (nhưng không nhất thiết đồng nhất nhau).</li>
  <li><em>expect(x).toBe(obj)</em>: Khẳng định rằng đối tượng <strong>x</strong> đồng nhất với <strong>obj</strong> (2 đối tượng này là một).</li>
  <li><em>expect(x).toMatch(regexp)</em>: Khẳng định chuỗi <strong>x</strong> khớp với biểu thức chính quy <strong>regexp</strong>.</li>
  <li><em>expect(x).toBeNull()</em>: Khẳng định rằng biến <strong>x</strong> chứa giá trị là <strong>null</strong>.</li>
  <li><em>expect(x).toBeTruthy()</em>: Khẳng định rằng giá trị <strong>x</strong> là <strong>true</strong> hoặc ước lượng bằng <strong>true</strong>.</li>
  <li><em>expect(x).toBeFalsy()</em>: Khẳng định rằng giá trị <strong>x</strong> là <strong>false</strong> hoặc ước lượng bằng <strong>false</strong>.</li>
  <li><em>expect(x).toContain(y)</em>: Khẳng định rằng <strong>x</strong> là một chuỗi ký tự và <strong>x</strong> chứa giá trị <strong>y</strong> (chuỗi <strong>y</strong> là một phần của chuỗi <strong>x</strong>).</li>
  <li><em>expect(x).toBeGreaterThan(y)</em>: Khẳng định rằng <strong>x</strong> lớn hơn <strong>y</strong>.</li>
  <li><em>expect(x).toBeDefined()</em>: Khẳng định rằng biến <strong>x</strong> đã được định nghĩa.</li>
  <li><em>expect(x).toBeUndefined()</em>: Khẳng định rằng biến <strong>x</strong> chưa được định nghĩa.</li>
</ul>

<h3 id="v-d-n-gin-v-unit-testing">Ví dụ đơn giản về Unit Testing</h3>

<p>Chúng ta tạo một ví dụ đơn giản sử dụng Karma để kiểm thử cho một chức năng (lưu ý là chưa liên quan đến AngularJS). </p>

<p>Trước tiên, tạo một thư mục có tên <em>example-karma-simple-unit-testing</em>, sau đó chuyển vào làm việc trong thư mục này:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>mkdir example-karma-simple-unit-testing
<span class="nv">$ </span><span class="nb">cd </span>example-karma-simple-unit-testing
<span class="nv">$ </span>npm install karma --save-dev
<span class="nv">$ </span>npm install karma-jasmine karma-chrome-launcher --save-dev
<span class="nv">$ </span>karma init karma-unit.conf.js
<span class="nv">$ </span>mkdir <span class="nb">test</span>
<span class="nv">$ </span>mkdir <span class="nb">test</span>/unit
<span class="nv">$ </span>touch <span class="nb">test</span>/unit/simpleSpec.js</code></pre></div>

<p>Mở phần mềm soạn thảo (<em>gedit</em>, <em>geany</em>, v.v.) để thêm mã lệnh kiểm thử sau vào tệp <em>simpleSpec.js</em>:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//</span>
<span class="c1">// file: example-karma-simple-unit-testing/test/unit/simpleSpec.js</span>
<span class="c1">//</span>
<span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;A very simple Unit testing&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">counter</span><span class="p">;</span>
    
    <span class="c1">// Preparation (set up a scenario)</span>
    <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">});</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;Increments value&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// attempt the operation</span>
        <span class="nx">counter</span><span class="o">++</span><span class="p">;</span>
        <span class="c1">// verify the result</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">counter</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">})</span>

    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;Decrements value&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// attempt the operation</span>
        <span class="nx">counter</span><span class="o">--</span><span class="p">;</span>
        <span class="c1">// verify the result</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">counter</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">})</span>
<span class="p">});</span></code></pre></div>

<p>Quay lại cửa sổ dòng lệnh và chạy Karma để kiểm thử:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>karma start karma-unit.conf.js</code></pre></div>

<h2 id="p-dng-unit-testing-cho-ng-dng-angularjs">Áp dụng Unit Testing cho ứng dụng AngularJS</h2>

<p>Ứng dụng xây dựng bằng AngularJS có các thành phần sau chứa mã lệnh cần được kiểm thử:</p>

<ul>
  <li>Controller (bao gồm cả Scope)</li>
  <li>Service</li>
  <li>Filter</li>
  <li>Directive</li>
</ul>

<p>AngularJS xem mỗi Controller, Service, Filter và Directive là một đơn vị chương trình, do đó cần được áp dụng kiểm thử đơn vị trong quá trình phát triển. Phần nội dung này của bài viết sẽ tập trung trình bày các khái niệm cũng như những kỹ thuật cơ bản để áp dụng kiểm thử đơn vị và các thành phần trên của AngularJS.</p>

<h3 id="k-thut-gi-lp-trong-kim-th-angularjs">Kỹ thuật giả lập trong kiểm thử AngularJS</h3>

<p>Trước khi tìm hiểu cách thức áp dụng kiểm thử đơn vị vào các thành phần của AngularJS, chúng ta cần hiểu rõ một kỹ thuật quan trọng trong lập trình kiểm thử: kỹ thuật giả lập (mocking). Giả lập trong kiểm thử đơn vị ứng dụng AngularJS là sự kết hợp giữa các hàm Spy của Jasmine với module ngMocks của AngularJS.</p>

<h4 id="khai-bo-th-vin-angular-mocks">Khai báo thư viện angular-mocks</h4>

<p>Để tạo các đối tượng giả dùng cho kiểm thử đơn vị trong AngularJS, chúng ta cần khai báo thư viện <em>angular-mocks</em> bằng cách bổ sung khai báo tệp <em>angular-mocks.js</em> trong cấu hình của Karma. Cần lưu ý thứ tự khai báo các tệp thư viện trong thuộc tính <em>files</em> của tệp cấu hình Karma:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//</span>
<span class="c1">// file: karma-unit.conf.js</span>
<span class="c1">//</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">({</span>
    
    <span class="c1">// ...</span>
  
    <span class="c1">// list of files / patterns to load in the browser</span>
    <span class="nx">files</span><span class="o">:</span> <span class="p">[</span>
      <span class="s1">&#39;main/lib/angular/angular.js&#39;</span><span class="p">,</span>
      <span class="s1">&#39;main/lib/angular/angular-mocks.js&#39;</span><span class="p">,</span>  
      <span class="s1">&#39;main/js/*.js&#39;</span><span class="p">,</span>
      <span class="s1">&#39;test/**/*Spec.js&#39;</span>
    <span class="p">],</span>
    
    <span class="c1">// .....</span>

  <span class="p">});</span>
<span class="p">};</span></code></pre></div>

<p>Một khi đã khai báo thư viện <em>angular-mocks</em>, chúng ta có thể viết lệnh tạo ngữ cảnh giả lập đối tượng cho module ứng dụng Angular cần kiểm thử.</p>

<h4 id="gi-lp-module-ng-dng-c-kim-th">Giả lập module ứng dụng được kiểm thử</h4>

<p>Chẳng hạn chúng ta cần kiểm thử đơn vị đối với Service có tên <em>myService</em> trong module ứng dụng <em>myApp</em>, khi đó chúng ta cần sử dụng hàm <strong>angular.mock.module()</strong> tạo ngữ cảnh giả lập đối tượng cho <em>myApp</em> ứng với từng lệnh kiểm thử <strong>it()</strong> như sau:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;myApp Unit Testing&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    
    <span class="c1">// Mock our &#39;myApp&#39; angular module</span>
    <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myApp&#39;</span><span class="p">));</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;Unit testing 1&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
        <span class="c1">// ... </span>
    <span class="p">});</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;Unit testing 2&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
        <span class="c1">// ... </span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<h4 id="thay-th-cc-dch-v-ph-thuc">Thay thế các dịch vụ phụ thuộc</h4>

<p>Quá trình <em>kiểm thử đơn vị</em> đòi hỏi phải cô lập thành phần đang được kiểm thử khỏi các thành phần phụ thuộc khác. Hàm <em>angular.mock.module()</em> cho phép mã lệnh kiểm thử lấy service <strong>$provide</strong> ra để định nghĩa lại (thay thế) các service phụ thuộc khác trước khi chạy hàm kiểm thử:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;myApp Unit Testing&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    
    <span class="c1">// Mock our &#39;myApp&#39; angular module</span>
    <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myApp&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$provide</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// sử dụng các hàm factory(), service(), value() của $provide</span>
    <span class="p">}));</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;Unit testing 1&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
        <span class="c1">// ... </span>
    <span class="p">});</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;Unit testing 2&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
        <span class="c1">// ... </span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<p>Có thể tìm hiểu thêm về nội dung này trong phần bài viết “<em>Áp dụng Unit Testing cho các Service</em>” bên dưới.</p>

<h4 id="ch-nh-dch-v-cn-s-dng">Chỉ định dịch vụ cần sử dụng</h4>

<p>Để kiểm thử các thành phần (Controller, Service, Filter, Directive), chúng ta cần tạo ra đối tượng cụ thể của thành phần đó, thay thế các dịch vụ phụ thuộc bằng các đối tượng giả lập, thực hiện các lời gọi hàm theo trình tự của kịch bản kiểm thử.</p>

<p>Để có thể tiếp cận các dịch vụ của AngularJS để sử dụng phục vụ quá trình kiểm thử (chẳng hạn tạo đối tượng thành phần cần được kiểm thử như mô tả ở trên), thư viện <em>angular-mocks</em> cung cấp hàm <em>angular.mock.inject()</em> như là một điểm giao tiếp để người viết mã lệnh kiểm thử có thể chỉ định các dịch vụ của AngularJs cần dùng. Ví dụ, để có thể tạo đối tượng để kiểm thử <em>myController</em>, người lập trình có thể viết mã lệnh kiểm thử như sau:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;myController Unit testing #1&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">mockScope</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">controller</span><span class="p">;</span>

    <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s2">&quot;myApp&quot;</span><span class="p">));</span>

    <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">inject</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$rootScope</span><span class="p">,</span> <span class="nx">$controller</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">mockScope</span> <span class="o">=</span> <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">$new</span><span class="p">();</span>
        <span class="nx">controller</span> <span class="o">=</span> <span class="nx">$controller</span><span class="p">(</span><span class="s2">&quot;myController&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">$scope</span><span class="o">:</span> <span class="nx">mockScope</span><span class="p">,</span>
        <span class="p">});</span>
    <span class="p">}));</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;unit testing function&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// testing code using controller and mockScope variables</span>
    <span class="p">})</span>
<span class="p">});</span></code></pre></div>

<p>Lưu ý về quy ước sử dụng dấu gạch dưới (underscore - <em>_</em>) trong tên gọi của dịch vụ cung cấp bởi <em>angular.mock.inject()</em>: Đôi khi chúng ta muốn đặt tên biến tham chiếu trùng với tên của dịch vụ để thuận tiện cho việc lập trình. Chẳng hạn, cách đặt tên biến someService sau có thể gây khó hiểu cho mã lệnh bên dưới:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;myService Unit Testing&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">someService</span><span class="p">;</span>

    <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">inject</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">myService</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">someService</span> <span class="o">=</span> <span class="nx">myService</span><span class="p">;</span>  <span class="c1">// &lt;-- we can&#39;t use the same name!</span>
    <span class="p">}));</span>

    <span class="c1">// There&#39;s a lot of code here ...</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;using someService&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// &lt;-- this is more confusing: what is someService, huh?</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<p>Thư viện <em>angular-mocks</em> đưa ra quy ước dịch vụ truyền vào hàm <em>angular.mock.inject()</em> có thể được bao trong cặp dấu gạch dưới, từ đó cho phép tên biến có thể trùng với tên dịch vụ. Khi đi tìm dịch vụ để truyền vào, <em>angular.mock.inject()</em> sẽ tự động loại bỏ cặp dấu gạch dưới để xác định đúng tên của dịch vụ cần tìm.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;myService Unit Testing&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">myService</span><span class="p">;</span> <span class="c1">// &lt;-- we can use the same name</span>

    <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">inject</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_myService_</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">myService</span> <span class="o">=</span> <span class="nx">_myService_</span><span class="p">;</span>
    <span class="p">}));</span>

    <span class="c1">// There&#39;s a lot of code here ...</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;using myService&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="c1">// It&#39;s ok. myService is myService</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<h3 id="p-dng-unit-testing-cho-cc-controller">Áp dụng Unit Testing cho các Controller</h3>

<h4 id="ti-v-d-minh-ha">Tải ví dụ minh họa</h4>

<p>Tải ví dụ minh họa “<a href="https://github.com/pnhung177/example-karma-unit-testing-controller">AngularJS Controller Unit Testing</a>” theo địa chỉ dành cho <a href="https://github.com/pnhung177/example-karma-unit-testing-controller.git">git clone</a> hoặc bản <a href="https://github.com/pnhung177/example-karma-unit-testing-controller/archive/master.zip">nén zip</a>. Sau khi tải xong ví dụ, chuyển vào thư mục <em>example-karma-unit-testing-controller</em>, thực hiện lệnh sau để cài đặt <strong>karma</strong>:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>npm install karma karma-jasmine karma-chrome-launcher --save-dev</code></pre></div>

<p>Sau khi <strong>npm</strong> cài đặt xong các gói thư viện, chạy thử ví dụ bằng lệnh:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>karma start karma-unit.conf.js</code></pre></div>

<h4 id="m-t-controller-cn-kim-th">Mô tả Controller cần kiểm thử</h4>

<p>Giả sử chúng ta cần tạo một Controller có tên <strong>myController</strong> thuộc ứng dụng <strong>myApp</strong>, thực hiện chức năng đơn giản là tăng giá trị cho biến <strong>counter</strong> mỗi khi người dùng bấm vào nút lệnh <strong>Increment</strong>:</p>

<p><img src="/blog/media/f65d9701-b730-4686-8160-b0b05b525703/example-karma-controller-unit-testing.png" alt="Ví dụ minh họa về Controller" /></p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//----------------------------------------------------------------------</span>
<span class="c1">// file: example-karma-unit-testing-controller/main/js/myController.js</span>
<span class="c1">//</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myApp&#39;</span><span class="p">,</span> <span class="p">[]);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;myController&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;$scope&#39;</span><span class="p">,</span> <span class="s1">&#39;backendService&#39;</span><span class="p">,</span> 
        <span class="kd">function</span><span class="p">(</span><span class="nx">$ctrlScope</span><span class="p">,</span> <span class="nx">$backend</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$ctrlScope</span><span class="p">.</span><span class="nx">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    
    <span class="nx">$ctrlScope</span><span class="p">.</span><span class="nx">incrementCounter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$ctrlScope</span><span class="p">.</span><span class="nx">counter</span> <span class="o">+=</span> <span class="nx">$backend</span><span class="p">.</span><span class="nx">step</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="nx">$ctrlScope</span><span class="p">.</span><span class="nx">resetCounter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$ctrlScope</span><span class="p">.</span><span class="nx">counter</span> <span class="o">=</span> <span class="nx">$backend</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}]);</span></code></pre></div>

<p>Lưu ý <strong>myController</strong> có sử dụng một Service có tên là <strong>backendService</strong>, Service này vẫn chưa được lập trình. Khi đó, ta cần giả lập <strong>backendService</strong> khi lập trình <strong>Spec</strong> kiểm thử <strong>myController</strong>.</p>

<h4 id="to-spec-kim-th-controller">Tạo Spec kiểm thử Controller</h4>

<p>Tạo một <strong>Spec Suite</strong> kiểm thử cho <strong>myController</strong>, định nghĩa trong tệp myController.Spec.js như sau:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//----------------------------------------------------------------------</span>
<span class="c1">// file: example-karma-unit-testing-controller/test/unit/myController.Spec.js</span>
<span class="c1">//</span>
<span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;myController Unit testing #1&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    
    <span class="c1">// Arrange</span>
    <span class="kd">var</span> <span class="nx">mockScope</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">controller</span><span class="p">;</span>

    <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s2">&quot;myApp&quot;</span><span class="p">));</span>

    <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">inject</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$controller</span><span class="p">,</span> <span class="nx">$rootScope</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">mockScope</span> <span class="o">=</span> <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">$new</span><span class="p">();</span>
        
        <span class="nx">controller</span> <span class="o">=</span> <span class="nx">$controller</span><span class="p">(</span><span class="s2">&quot;myController&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">$scope</span><span class="o">:</span> <span class="nx">mockScope</span><span class="p">,</span>
            <span class="nx">backendService</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">},</span>
                <span class="nx">step</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="mi">5</span><span class="p">;</span>
                <span class="p">},</span>
                <span class="nx">echo</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="s1">&#39;echo[&#39;</span> <span class="o">+</span> <span class="nx">msg</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}));</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;Creates variable&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">mockScope</span><span class="p">.</span><span class="nx">counter</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">})</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;Increments counter&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">mockScope</span><span class="p">.</span><span class="nx">incrementCounter</span><span class="p">();</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">mockScope</span><span class="p">.</span><span class="nx">counter</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
    <span class="p">});</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;Resets counter&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">mockScope</span><span class="p">.</span><span class="nx">resetCounter</span><span class="p">();</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">mockScope</span><span class="p">.</span><span class="nx">counter</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<p>Lưu ý Service <strong>backendService</strong> được giả lập trực tiếp bằng cách định nghĩa một <em>đối tượng cụ thể</em> và gán cho thuộc tính <strong>backendService</strong> trong quá trình tạo <strong>myController</strong>.</p>

<h4 id="ci-tin-cch-kim-th">Cải tiến cách kiểm thử</h4>

<p>Chúng ta có thể cải tiến cách giả lập Service <strong>backendService</strong> bằng cách sử dụng các hàm <strong>spyOn()</strong> của Jasmine để định nghĩa các hàm của Service <strong>backendService</strong> ngay trong từng hàm kiểm thử (<strong>Spec</strong>).</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//----------------------------------------------------------------------</span>
<span class="c1">// file: example-karma-unit-testing-controller/test/unit/myController.Spec.js</span>
<span class="c1">//</span>
<span class="nx">describe</span><span class="p">(</span><span class="s2">&quot;myController Unit testing #2&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    
    <span class="c1">// Arrange</span>
    <span class="kd">var</span> <span class="nx">mockScope</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">mockBackendService</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">controller</span><span class="p">;</span>

    <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s2">&quot;myApp&quot;</span><span class="p">));</span>

    <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">inject</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$controller</span><span class="p">,</span> <span class="nx">$rootScope</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">mockScope</span> <span class="o">=</span> <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">$new</span><span class="p">();</span>
        
        <span class="nx">mockBackendService</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{},</span>
            <span class="nx">step</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{}</span>
        <span class="p">};</span>
        
        <span class="nx">controller</span> <span class="o">=</span> <span class="nx">$controller</span><span class="p">(</span><span class="s2">&quot;myController&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">$scope</span><span class="o">:</span> <span class="nx">mockScope</span><span class="p">,</span>
            <span class="nx">backendService</span><span class="o">:</span> <span class="nx">mockBackendService</span>
        <span class="p">});</span>
    <span class="p">}));</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;Creates variable&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">mockScope</span><span class="p">.</span><span class="nx">counter</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">})</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;Increments counter&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">spyOn</span><span class="p">(</span><span class="nx">mockBackendService</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">).</span><span class="nx">and</span><span class="p">.</span><span class="nx">callFake</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="mi">5</span><span class="p">;</span>
        <span class="p">});</span>

        <span class="nx">mockScope</span><span class="p">.</span><span class="nx">incrementCounter</span><span class="p">();</span>
        
        <span class="nx">expect</span><span class="p">(</span><span class="nx">mockScope</span><span class="p">.</span><span class="nx">counter</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
    <span class="p">});</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;Resets counter&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">spyOn</span><span class="p">(</span><span class="nx">mockBackendService</span><span class="p">,</span> <span class="s1">&#39;init&#39;</span><span class="p">).</span><span class="nx">and</span><span class="p">.</span><span class="nx">callFake</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">});</span>
        
        <span class="nx">mockScope</span><span class="p">.</span><span class="nx">resetCounter</span><span class="p">();</span>
        
        <span class="nx">expect</span><span class="p">(</span><span class="nx">mockBackendService</span><span class="p">.</span><span class="nx">init</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">mockScope</span><span class="p">.</span><span class="nx">counter</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<h3 id="p-dng-unit-testing-cho-cc-service">Áp dụng Unit Testing cho các Service</h3>

<h4 id="ti-v-d-minh-ha-1">Tải ví dụ minh họa</h4>

<p>Tải ví dụ minh họa “<a href="https://github.com/pnhung177/example-karma-unit-testing-service">AngularJS Service Unit Testing</a>” theo địa chỉ dành cho <a href="https://github.com/pnhung177/example-karma-unit-testing-service.git">git clone</a> hoặc bản <a href="https://github.com/pnhung177/example-karma-unit-testing-service/archive/master.zip">nén zip</a>. Sau khi tải xong ví dụ, chuyển vào thư mục <em>example-karma-unit-testing-service</em>, thực hiện lệnh sau để cài đặt <strong>karma</strong>:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>npm install karma karma-jasmine karma-chrome-launcher --save-dev</code></pre></div>

<p>Sau khi <strong>npm</strong> cài đặt xong các gói thư viện, chạy thử ví dụ bằng lệnh:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>karma start karma-unit.conf.js</code></pre></div>

<h4 id="m-t-service-cn-kim-th">Mô tả Service cần kiểm thử</h4>

<p>Tương tự như với <strong>myControler</strong>, chúng ta cũng xem xét một Service đơn giản có tên là <strong>myService</strong>, có chức năng đơn giản như sau:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//----------------------------------------------------------------------</span>
<span class="c1">// file: example-karma-unit-testing-service/main/js/myService.js</span>
<span class="c1">//</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myApp&#39;</span><span class="p">,</span> <span class="p">[]);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;myService&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;backendService&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$backend</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="nx">test</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s2">&quot;Returned message:&quot;</span> <span class="o">+</span> <span class="nx">$backend</span><span class="p">.</span><span class="nx">echo</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">}]);</span></code></pre></div>

<p>Trong đoạn mã lệnh trên, <strong>myService</strong> sử dụng hàm <strong>echo()</strong> của một Service chưa tồn tại có tên là <strong>backendService</strong>. Để kiểm thử <strong>myService</strong> (trong ví dụ này, <strong>myService</strong> chỉ có một hàm là <strong>test()</strong>), chúng ta sẽ giả lập Service <strong>backendService</strong>. </p>

<h4 id="to-spec-kim-th-service">Tạo Spec kiểm thử Service</h4>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//----------------------------------------------------------------------</span>
<span class="c1">// file: example-karma-unit-testing-service/test/unit/myService.Spec.js</span>
<span class="c1">//</span>
<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;myService Unit Testing&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(){</span>
    
    <span class="kd">var</span> <span class="nx">myService</span><span class="p">,</span> <span class="nx">mockBackend</span><span class="p">;</span>

    <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myApp&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$provide</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">mockBackend</span> <span class="o">=</span> <span class="nx">jasmine</span><span class="p">.</span><span class="nx">createSpyObj</span><span class="p">(</span><span class="s1">&#39;backendService&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;echo&#39;</span><span class="p">]);</span>
        <span class="nx">$provide</span><span class="p">.</span><span class="nx">value</span><span class="p">(</span><span class="s1">&#39;backendService&#39;</span><span class="p">,</span> <span class="nx">mockBackend</span><span class="p">);</span>
    <span class="p">}));</span>
    
    <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">inject</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">_myService_</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">myService</span> <span class="o">=</span> <span class="nx">_myService_</span><span class="p">;</span>
    <span class="p">}));</span>

    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should call backendService.echo on myService.test&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">mockBackend</span><span class="p">.</span><span class="nx">echo</span><span class="p">.</span><span class="nx">and</span><span class="p">.</span><span class="nx">callFake</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s1">&#39;echo[&#39;</span> <span class="o">+</span> <span class="nx">msg</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">;</span>
        <span class="p">});</span>
        
        <span class="c1">// make the call.</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nx">myService</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">);</span>

        <span class="c1">// check our spy to see if echo was called properly.</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">mockBackend</span><span class="p">.</span><span class="nx">echo</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">);</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="s2">&quot;Returned message:echo[Hello]&quot;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<h3 id="p-dng-unit-testing-cho-cc-filter">Áp dụng Unit Testing cho các Filter</h3>

<h4 id="ti-v-d-minh-ha-2">Tải ví dụ minh họa</h4>

<p>Tải ví dụ minh họa “<a href="https://github.com/pnhung177/example-karma-unit-testing-filter">AngularJS Filter Unit Testing</a>” theo địa chỉ dành cho <a href="https://github.com/pnhung177/example-karma-unit-testing-filter.git">git clone</a> hoặc bản <a href="https://github.com/pnhung177/example-karma-unit-testing-filter/archive/master.zip">nén zip</a>. Sau khi tải xong ví dụ, chuyển vào thư mục <em>example-karma-unit-testing-filter</em>, thực hiện lệnh sau để cài đặt <strong>karma</strong>:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>npm install karma karma-jasmine karma-chrome-launcher --save-dev</code></pre></div>

<p>Sau khi <strong>npm</strong> cài đặt xong các gói thư viện, chạy thử ví dụ bằng lệnh:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>karma start karma-unit.conf.js</code></pre></div>

<h4 id="m-t-filter-cn-kim-th">Mô tả Filter cần kiểm thử</h4>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//----------------------------------------------------------------------</span>
<span class="c1">// file: example-karma-unit-testing-filter/main/js/myFilter.js</span>
<span class="c1">//</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myApp&#39;</span><span class="p">,</span> <span class="p">[]);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;myFilter&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">number</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">number</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">isNumber</span><span class="p">(</span><span class="nx">number</span><span class="p">)</span> <span class="o">?</span> <span class="nx">number</span> <span class="o">:</span> <span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">number</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">number</span> <span class="o">&gt;=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">sub</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">number</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">sub</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">+</span> <span class="nx">value</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">number</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>
<span class="p">});</span></code></pre></div>

<h4 id="to-spec-kim-th-filter">Tạo Spec kiểm thử Filter</h4>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//----------------------------------------------------------------------</span>
<span class="c1">// file: example-karma-unit-testing-filter/test/unit/myFilter.Spec.js</span>
<span class="c1">//</span>
<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;myFilter Unit Testing&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(){</span>
    
    <span class="kd">var</span> <span class="nx">filterInstance</span><span class="p">;</span>
    <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s2">&quot;myApp&quot;</span><span class="p">));</span>
    
    <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">inject</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$filter</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">filterInstance</span> <span class="o">=</span> <span class="nx">$filter</span><span class="p">(</span><span class="s2">&quot;myFilter&quot;</span><span class="p">);</span>
    <span class="p">}));</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;Uppercase full length of string&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">filterInstance</span><span class="p">(</span><span class="s2">&quot;testing filter&quot;</span><span class="p">);</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="s2">&quot;TESTING FILTER&quot;</span><span class="p">);</span>
    <span class="p">});</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="s2">&quot;Uppercase first five characters of string&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">filterInstance</span><span class="p">(</span><span class="s2">&quot;testing filter&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">).</span><span class="nx">toEqual</span><span class="p">(</span><span class="s2">&quot;TESTIng filter&quot;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<h3 id="p-dng-unit-testing-cho-cc-directive">Áp dụng Unit Testing cho các Directive</h3>

<h4 id="ti-v-d-minh-ha-3">Tải ví dụ minh họa</h4>

<p>Tải ví dụ minh họa “<a href="https://github.com/pnhung177/example-karma-unit-testing-directive">AngularJS Directive Unit Testing</a>” theo địa chỉ dành cho <a href="https://github.com/pnhung177/example-karma-unit-testing-directive.git">git clone</a> hoặc bản <a href="https://github.com/pnhung177/example-karma-unit-testing-directive/archive/master.zip">nén zip</a>. Sau khi tải xong ví dụ, chuyển vào thư mục <em>example-karma-unit-testing-directive</em>, thực hiện lệnh sau để cài đặt <strong>karma</strong>:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>npm install karma karma-jasmine karma-chrome-launcher --save-dev</code></pre></div>

<p>Sau khi <strong>npm</strong> cài đặt xong các gói thư viện, chạy thử ví dụ bằng lệnh:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>karma start karma-unit.conf.js</code></pre></div>

<h4 id="m-t-directive-cn-kim-th">Mô tả Directive cần kiểm thử</h4>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//----------------------------------------------------------------------</span>
<span class="c1">// file: example-karma-unit-testing-directive/main/js/myDirective.js</span>
<span class="c1">//</span>
<span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myApp&#39;</span><span class="p">,</span> <span class="p">[]);</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">directive</span><span class="p">(</span><span class="s1">&#39;myDirective&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$timeout</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> 
        <span class="s1">&#39;&lt;div class=&quot;notification&quot;&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;div class=&quot;notification-content&quot;&gt;&#39;</span> <span class="o">+</span>
                <span class="s1">&#39;&lt;p&gt;&lt;/p&gt;&#39;</span> <span class="o">+</span>
            <span class="s1">&#39;&lt;/div&gt;&#39;</span> <span class="o">+</span>
        <span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="nx">restrict</span><span class="o">:</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span>
        <span class="nx">scope</span><span class="o">:</span> <span class="p">{</span> <span class="nx">message</span><span class="o">:</span> <span class="s1">&#39;=&#39;</span> <span class="p">},</span>
        <span class="nx">template</span><span class="o">:</span> <span class="nx">html</span><span class="p">,</span>
        <span class="nx">replace</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}</span>
<span class="p">});</span></code></pre></div>

<h4 id="to-spec-kim-th-directive">Tạo Spec kiểm thử Directive</h4>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//----------------------------------------------------------------------</span>
<span class="c1">// file: example-karma-unit-testing-directive/test/unit/myDirective.Spec.js</span>
<span class="c1">//</span>
<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;myDirective Unit Testing&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">mockElement</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">mockScope</span><span class="p">;</span>

    <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myApp&#39;</span><span class="p">));</span>

    <span class="nx">beforeEach</span><span class="p">(</span><span class="nx">angular</span><span class="p">.</span><span class="nx">mock</span><span class="p">.</span><span class="nx">inject</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$compile</span><span class="p">,</span> <span class="nx">$rootScope</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">mockScope</span> <span class="o">=</span> <span class="nx">$rootScope</span><span class="p">.</span><span class="nx">$new</span><span class="p">();</span>
        <span class="nx">mockElement</span> <span class="o">=</span> <span class="nx">angular</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span>
                <span class="s1">&#39;&lt;my-directive message=&quot;note&quot;&gt;&lt;/my-directive&gt;&#39;</span><span class="p">);</span>
        <span class="nx">$compile</span><span class="p">(</span><span class="nx">mockElement</span><span class="p">)(</span><span class="nx">mockScope</span><span class="p">);</span>
        <span class="nx">mockScope</span><span class="p">.</span><span class="nx">$apply</span><span class="p">();</span>
    <span class="p">}));</span>
    
    <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should display the welcome text&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">mockScope</span><span class="p">.</span><span class="nx">$apply</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">mockScope</span><span class="p">.</span><span class="nx">note</span> <span class="o">=</span> <span class="s2">&quot;Welcome to Danang Javascript&quot;</span><span class="p">;</span>
        <span class="p">});</span>
        <span class="nx">expect</span><span class="p">(</span><span class="nx">mockElement</span><span class="p">.</span><span class="nx">html</span><span class="p">()).</span><span class="nx">toContain</span><span class="p">(</span><span class="s2">&quot;Welcome to Danang Javascript&quot;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<h2 id="ti-liu-tham-kho">Tài liệu tham khảo</h2>

<ul>
  <li><a href="https://docs.angularjs.org/guide/unit-testing">AngularJS Documentation for unit-testing</a></li>
  <li><a href="http://andyshora.com/unit-testing-best-practices-angularjs.html">Unit Testing Best Practices in AngularJS</a></li>
  <li><a href="http://karma-runner.github.io/0.12/intro/installation.html">Karma Documentation - Installation</a></li>
  <li><a href="https://docs.angularjs.org/api/ngMock/function/angular.mock.module">Function components in ngMock - angular.mock.module</a></li>
  <li><a href="https://docs.angularjs.org/api/ngMock/function/angular.mock.inject">Function components in ngMock - angular.mock.inject</a></li>
</ul>


            </div>
        </article>

        <div class="cf"></div>
        <div class="row text-center">
            <section class="cheryk-post-share">
                <a class="twitter-icon" href="https://twitter.com/intent/tweet?text=&quot;Kiểm thử đơn vị (Unit Testing) trong AngularJS&quot;%20/blog/javascript/angularjs/kiem-thu-don-vi-unit-testing-trong-angularjs.html%20via%20&#64;pnhung177"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
                    <i class="fa fa-twitter"></i>
                </a>
                <a class="facebook-icon" href="https://www.facebook.com/sharer/sharer.php?u=/blog/javascript/angularjs/kiem-thu-don-vi-unit-testing-trong-angularjs.html"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
                    <i class="fa fa-facebook"></i>
                </a>
                <a class="google-icon" href="https://plus.google.com/share?url=/blog/javascript/angularjs/kiem-thu-don-vi-unit-testing-trong-angularjs.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title="Share on Google+">
                    <i class="fa fa-google-plus"></i>
                </a>
            </section>
        </div>
        <div class="cf"></div>
            <div class="cheryk-author-info">
                <div class="row">
                    <section class="cheryk-post-author small-12 columns">
                        
                            <img src="/blog/images/avatars/pnhung177.png" class="cheryk-post-author-avatar" alt="Phạm Ngọc Hùng's photo">
                        
                            <span class="author-label">Author</span>
                            <h1>Phạm Ngọc Hùng</h1>
                        
                            <p><a href="mailto:pnhung177@drupalex.net" class="author-website">pnhung177@drupalex.net</a></p>
                        
                            <p>... when the sun comes up, you better be running!</p>
                        
                    </section>
                </div>
            </div> 
        <div class="cf"></div>

        
        <section class="cheryk-disqus row">
    <div class="small-12 columns">
        <h1 class="cheryk-comments-header">Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'acegik'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
</section>

         
</main> 


<div class="cf"></div>
<footer class="cheryk-site-footer">
    <div class="copyright">
         <section>Bản quyền nội dung thuộc về <a href="/blog/about">Phạm Ngọc Hùng</a> &copy; 2015.</section>
    </div>
    <div class="social-icons">
        
        
        <a href="http://twitter.com/pnhung177">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-twitter fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="https://plus.google.com/u/3/115458186421626071505">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-google-plus fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="http://github.com/pnhung177">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-github fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="http://facebook.com/pnhung177">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-facebook fa-stack-1x"></i>
            </span>
        </a>
        
    </div>
    
    <div class="cf"></div>
</footer>

<script src="/blog/assets/js/vendor/modernizr.js"></script>
<script src="/blog/assets/js/foundation.min.js"></script>
<script src="/blog/assets/js/vendor/background-check.js"></script>
<script src="/blog/assets/js/vendor/post-header-animations.js"></script>
<script src="/blog/assets/js/main.js"></script>

<script>
  $(document).foundation();
</script>



<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54128248-1', 'auto');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');

</script>


  
</body>
</html>
