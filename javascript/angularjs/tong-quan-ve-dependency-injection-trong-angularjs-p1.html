<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>TổNG QUAN Về DEPENDENCY INJECTION TRONG ANGULARJS (P1) &vert; ACEGIK'S BLOG</title>
<meta name="description" content="... when the sun comes up, you better be running!">
<meta name="keywords" content="JavaScript, AngularJS">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/blog/images/logo.png">
<meta name="twitter:title" content="Tổng quan về Dependency Injection trong AngularJS (P1)">
<meta name="twitter:description" content="... when the sun comes up, you better be running!">
<meta name="twitter:creator" content="@pnhung177">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Tổng quan về Dependency Injection trong AngularJS (P1)">
<meta property="og:description" content="... when the sun comes up, you better be running!">
<meta property="og:url" content="/blog/javascript/angularjs/tong-quan-ve-dependency-injection-trong-angularjs-p1.html">
<meta property="og:site_name" content="Acegik's Blog">
<meta property="og:image" content="/blog/images/">





<link rel="canonical" href="/blog/javascript/angularjs/tong-quan-ve-dependency-injection-trong-angularjs-p1.html">
<link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="Acegik's Blog Feed">
<link rel="author" href="https://plus.google.com/u/3/115458186421626071505?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700|Open+Sans:400,600,300,800,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="/blog/assets/css/font-awesome.min.css">
<link rel="stylesheet" href="/blog/assets/css/vendor/normalize.css">
<link rel="stylesheet" href="/blog/assets/css/vendor/foundation.min.css">
<link rel="stylesheet" href="/blog/assets/css/style.css">
<link rel="stylesheet" href="/blog/assets/css/post.css">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/blog/assets/js/vendor/jquery-1.11.1.min.js"><\/script>')</script>





<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/blog/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/blog/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/blog/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/blog/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/blog/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/blog/images/apple-touch-icon-144x144-precomposed.png">

</head>
<body class="post-template" itemscope itemtype="http://schema.org/WebPage">


        <main id="cheryk-post-container-simple" class="cheryk-post-container-simple" role="main">
            <header class="cheryk-post-header-simple">
                <div class="cheryk-post-menu-header-simple">

                    <a class="cheryk-blog-logo" href="/blog">
                        <img src="/blog/images/logo.png" alt="Blog Logo" />
                    </a>

                <div class="cheryk-blog-menu">      
    <div class="cheryk-mobile-menu show-for-small">
        <a href="#"><i class="fa fa-bars"></i></a>
    </div>
    <ul class="cheryk-menu">
        <li class="cheryk-mobile-close-btn show-for-small text-right">
            <a href="#"><i class="fa fa-times"></i></a>
        </li>

            <li>
                    <a href="/blog/">Trang bìa</a>
                 </li>

            <li>
                    <a href="/blog/featured">Danh sách</a>
                 </li>

            <li>
                    <a href="/blog/categories">Phân loại</a>
                 </li>

            <li>
                    <a href="/blog/about">Giới thiệu</a>
                 </li>
            
           <li><a href="/blog/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
    </ul>

</div>
            </div>

                <div class="cheryk-post-title-simple row">
                    <div class="small-12 columns">
                        <div class="cheryk-post-meta-simple">
                            <h1>Tổng quan về Dependency Injection trong AngularJS (P1)</h1>
                            <p>by <strong>pnhung177</strong> &#8212; on <a href="/blog/tags/index.html#JavaScript" data-toggle="tooltip" title="Posts tagged with JavaScript" rel="tag">JavaScript</a>&nbsp;&comma;&nbsp;<a href="/blog/tags/index.html#AngularJS" data-toggle="tooltip" title="Posts tagged with AngularJS" rel="tag">AngularJS</a> &#8212; <strong><time datetime="2014-10-14T00:00:00+07:00">14/10/2014</time></strong></p>
                        </div>
                    </div>
                </div>
            </header>

        <article class="cheryk-post-content post tag-simple">
            <div><p><strong>Dependency Injection</strong> là mẫu hình thiết kế hiện đại, có mặt trong phần lớn các <em>khung ứng dụng</em> bằng những ngôn ngữ lập trình khác nhau hiện nay. <em>AngularJS</em> cũng không là ngoại lệ. Việc hiểu rõ về <em>Dependency Injection</em>, đặc biệt trong <em>Javascript</em> đóng một vai trò hết sức quan trọng trong việc nắm vững và sử dụng thành thạo <em>AngularJS</em>.</p>

<section>
  <header>
    <h2>Nội dung trình bày</h2>
  </header>
<div id="drawer">
<ul id="markdown-toc">
  <li><a href="#khi-lc-v-dependency-injection">Khái lược về Dependency Injection</a>    <ul>
      <li><a href="#s-ph-thuc-gia-cc-i-tng">Sự phụ thuộc giữa các đối tượng</a></li>
      <li><a href="#vy-dependency-injection-l-g">Vậy, Dependency Injection là gì?</a></li>
      <li><a href="#ci-t-dependency-injection">Cài đặt Dependency Injection</a>        <ul>
          <li><a href="#service-locator-injection">Service Locator Injection</a></li>
          <li><a href="#automated-dependency-injection">Automated Dependency Injection</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#ti-liu-tham-kho">Tài liệu tham khảo</a></li>
</ul>

  </div>
</section>

<h2 id="khi-lc-v-dependency-injection">Khái lược về Dependency Injection</h2>

<p>Trước khi tìm hiểu cách thức <em>Dependency Injection</em> được cài đặt và vận hành trong <em>AngularJS</em> như thế nào, chúng ta ôn lại sơ lược về khái niệm <em>Dependency Injection</em> và cách áp dụng mẫu hình thiết kế này trong Javascript.</p>

<h3 id="s-ph-thuc-gia-cc-i-tng">Sự phụ thuộc giữa các đối tượng</h3>

<p>Lập trình hướng đối tượng (OOP) là phương pháp chia tách dữ liệu và mã lệnh trong chương trình phần mềm thành các nhóm, sau đó đóng gói các nhóm này thành các khối cô lập gọi là đối tượng - tương ứng với các thực thể ngoài đời thực có liên quan đến chương trình phần mềm. Theo cách này, chương trình phần mềm có thể được hình dung như là một quần thể các đối tượng tương tác với nhau.</p>

<p><img src="/blog/media/f973ec46-ece6-432b-a96f-46bd93f738e8/OOP-Objects.png" alt="Chương trình là quần thể các đối tượng tương tác với nhau" /></p>

<p>Các đối tượng tương tác với nhau thông qua việc truyền mesage dưới dạng một lời gọi hàm. Đối tượng chứa hàm (tức là đối tượng sẽ nhận message) được gọi là <em>callee object</em>. Đối tượng gọi hàm (là đối tượng gửi message) được gọi là <em>caller object</em>. </p>

<p><img src="/blog/media/f973ec46-ece6-432b-a96f-46bd93f738e8/caller_object_send_a_message_to_callee_object.png" alt="Các đối tượng tương tác với nhau thông qua gọi hàm" /></p>

<p>Có 3 cách để <em>caller object</em> có thể tham chiếu đến được <em>callee object</em> để có thể thực hiện lời gọi hàm:</p>

<p><strong>Cách 1</strong>. <em>caller object</em> có thể tạo ra <em>callee object</em> bên trong hàm khởi tạo của <em>Caller</em>, thông thường là áp dụng toán tử <strong>new</strong> đối với hàm khởi tạo của <em>Callee</em>.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">Callee</span><span class="p">(</span><span class="nx">calleeName</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">myname</span> <span class="o">=</span> <span class="nx">calleeName</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">receiveACall</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Hello &quot;</span> <span class="o">+</span> <span class="nx">myname</span> <span class="o">+</span> <span class="s2">&quot;, This&#39;s &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Caller</span><span class="p">(</span><span class="nx">callerName</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">myname</span> <span class="o">=</span> <span class="nx">callerName</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">callee</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Callee</span><span class="p">(</span><span class="s2">&quot;Viet&quot;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">makeACall</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">callee</span><span class="p">.</span><span class="nx">receiveACall</span><span class="p">(</span><span class="nx">myname</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">caller</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Caller</span><span class="p">(</span><span class="s2">&quot;Nam&quot;</span><span class="p">);</span>
<span class="nx">caller</span><span class="p">.</span><span class="nx">makeACall</span><span class="p">();</span></code></pre></div>

<p>Dễ nhận thấy mã lệnh sử dụng để xác định <em>callee object</em> gắn kèm với mã lệnh khởi tạo <em>callee object</em>, dẫn đến những chỉnh sửa thông số khởi tạo <em>Callee</em> sau này sẽ làm ảnh hướng đến <em>Caller</em>.</p>

<p><strong>Cách 2</strong>. <em>caller object</em> có thể truy cập đến <em>callee object</em> khi cần, bằng cách tham chiếu đến một biến toàn cục.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">Callee</span><span class="p">(</span><span class="nx">calleeName</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">myname</span> <span class="o">=</span> <span class="nx">calleeName</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">receiveACall</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Hello &quot;</span> <span class="o">+</span> <span class="nx">myname</span> <span class="o">+</span> <span class="s2">&quot;, This&#39;s &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Caller</span><span class="p">(</span><span class="nx">callerName</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">myname</span> <span class="o">=</span> <span class="nx">callerName</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">makeACall</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">a_global_variable</span><span class="p">.</span><span class="nx">receiveACall</span><span class="p">(</span><span class="nx">myname</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">a_global_variable</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Callee</span><span class="p">(</span><span class="s2">&quot;Viet&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">caller</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Caller</span><span class="p">(</span><span class="s2">&quot;Nam&quot;</span><span class="p">);</span>
<span class="nx">caller</span><span class="p">.</span><span class="nx">makeACall</span><span class="p">();</span></code></pre></div>

<p>Theo cách này, hàm khởi tạo của <em>Caller</em> lại phụ thuộc vào biến toàn cục (là nhân tố thứ ba, nằm ngoài phạm vi <em>caller object</em> và <em>callee object</em>). Điều này là “cấm kỵ” trong lập trình hướng đối tượng.</p>

<p><strong>Cách 3</strong>. <em>caller object</em> được truyền tham chiếu trỏ đến <em>callee object</em> vào nơi mà nó cần, chẳng hạn vào hàm khởi tạo, hoặc thông qua phương thức <em>setter</em>.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">Callee</span><span class="p">(</span><span class="nx">calleeName</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">myname</span> <span class="o">=</span> <span class="nx">calleeName</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">receiveACall</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Hello &quot;</span> <span class="o">+</span> <span class="nx">myname</span> <span class="o">+</span> <span class="s2">&quot;, This&#39;s &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Caller</span><span class="p">(</span><span class="nx">callerName</span><span class="p">,</span> <span class="nx">calleeRef</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">myname</span> <span class="o">=</span> <span class="nx">callerName</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">callee</span> <span class="o">=</span> <span class="nx">calleeRef</span><span class="p">;</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">setCallee</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">calleeRef</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callee</span> <span class="o">=</span> <span class="nx">calleeRef</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">makeACall</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">callee</span><span class="p">.</span><span class="nx">receiveACall</span><span class="p">(</span><span class="nx">myname</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">callee</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Callee</span><span class="p">(</span><span class="s2">&quot;Viet&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">caller</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Caller</span><span class="p">(</span><span class="s2">&quot;Nam&quot;</span><span class="p">,</span> <span class="nx">callee</span><span class="p">);</span>
<span class="nx">caller</span><span class="p">.</span><span class="nx">makeACall</span><span class="p">();</span></code></pre></div>

<p>Theo cách này, hàm khởi tạo <em>Caller</em> chỉ phụ thuộc vào hàm mà nó gọi (đây là điều không thể tránh khỏi được), chứ không còn phụ thuộc vào lệnh khởi tạo <em>callee object</em>. <em>callee object</em> được tạo ở bên ngoài và truyền vào <em>caller object</em> thông qua hàm khởi tạo. Đây chính là một trong những cách để đẩy mã lệnh phụ thuộc ra bên ngoài định nghĩa đối tượng.</p>

<p><strong>Nhận xét chung</strong>: Hai cách đầu, thường được gọi là viết cứng mã lệnh (hard code) của đối tượng phụ thuộc (<em>callee object</em>) vào bên trong <em>caller object</em>. Điều này sẽ gây khó khăn cho việc chỉnh sửa những phần phụ thuộc: mã lệnh khởi tạo, tên lớp đối tượng, tên biến toàn cục, v.v. Ngoài ra, cũng rất khó khăn trong việc thực hiện Unit Test, là kỹ thuật đòi hỏi phải cô lập các thành phần phụ thuộc.</p>

<h3 id="vy-dependency-injection-l-g">Vậy, Dependency Injection là gì?</h3>

<h3 id="ci-t-dependency-injection">Cài đặt Dependency Injection</h3>

<p>Có rất nhiều cách để áp dụng <em>Dependency Injection</em> tùy thuộc vào đặc trưng của ngôn ngữ lập trình. Đối với Javascript, chúng ta có thể sử dụng <em>Service Locator Injection</em> hoặc <em>Constructor Injection</em> hoặc kết hợp cả 2 cách này để xây dựng <em>Dependency Injection</em>.</p>

<p><img src="/blog/media/f973ec46-ece6-432b-a96f-46bd93f738e8/dependency-injection-implementation.png" alt="Những cách thức áp dụng Dependency Injection" /></p>

<h4 id="service-locator-injection">Service Locator Injection</h4>

<p><em>Service Locator</em> là mẫu hình thiết kế được dùng để khởi tạo các <em>Service</em> và tra cứu các <em>Service</em> thông qua tên gọi của nó. Đoạn mã lệnh dưới đây khai báo hàm cấu tử của một đối tượng <em>ServiceLocator</em>.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">ServiceLocator</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">services</span> <span class="o">=</span> <span class="p">{};</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">svc</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">services</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">svc</span><span class="p">)</span> <span class="p">{</span> 
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;No service registered with name: &#39;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">svc</span><span class="p">;</span>
    <span class="p">};</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">svc</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">existing</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">services</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">existing</span><span class="p">)</span> <span class="p">{</span> 
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Service[&#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;] already registered&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">services</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">svc</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">services</span><span class="p">[</span><span class="nx">name</span><span class="p">].</span><span class="nx">$locator</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">unregister</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">services</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">reset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">services</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span></code></pre></div>

<p>Đoạn mã lệnh tiếp theo khai báo các hàm cấu tử của 2 lớp đối tượng: <em>Caller</em> và <em>Callee</em>. </p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">Callee</span><span class="p">(</span><span class="nx">myname</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">myname</span> <span class="o">=</span> <span class="nx">myname</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">receiveACall</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;Hello &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">myname</span> <span class="o">+</span> <span class="s2">&quot;, This&#39;s &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Caller</span><span class="p">(</span><span class="nx">myname</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">myname</span> <span class="o">=</span> <span class="nx">myname</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">makeACall</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$locator</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;callee&quot;</span><span class="p">).</span><span class="nx">receiveACall</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">myname</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Cuối cùng là mã lệnh sử dụng <em>$locator</em> để đăng ký các đối tượng và truyền đối tượng <em>callee object</em> cho <em>caller object</em> sử dụng:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">$locator</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ServiceLocator</span><span class="p">();</span>
<span class="nx">$locator</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;callee&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Callee</span><span class="p">(</span><span class="s2">&quot;Viet&quot;</span><span class="p">));</span>
<span class="nx">$locator</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">&quot;caller&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Caller</span><span class="p">(</span><span class="s2">&quot;Nam&quot;</span><span class="p">));</span>
<span class="nx">$locator</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;caller&quot;</span><span class="p">).</span><span class="nx">makeACall</span><span class="p">();</span></code></pre></div>

<p>Với cách này, rõ ràng <em>caller object</em> chỉ còn phụ thuộc vào lệnh gọi hàm (cụ thể là hàm <em>receiveACall()</em>) của <em>callee object</em>. Lệnh khởi tạo đối tượng <em>callee object</em> đã “bị” đẩy ra bên ngoài.</p>

<h4 id="automated-dependency-injection">Automated Dependency Injection</h4>

<p>Ví dụ trong mục <strong>Cách 3</strong> ở phần trên, minh họa cho kỹ thuật <em>Constructor Injection</em> trong đó <em>callee object</em> được truyền vào cho <em>caller object</em> dưới dạng tham số của hàm khởi tạo (Constructor) của <em>Caller</em>. Tuy nhiên, trong ví dụ đó, việc khởi tạo các đối tượng, truyền đối tượng vào hàm khởi tạo đều thực hiện “bằng tay”. </p>

<p>Phần này trình bày một ví dụ nhỏ, Chúng ta sẽ xem xét quá trình <em>bơm truyền</em> tự động trong ví dụ minh họa bên dưới.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">$injector</span> <span class="o">=</span> <span class="k">new</span> <span class="kd">function</span> <span class="nx">InjectorClass</span><span class="p">()</span> <span class="p">{</span>
    
    <span class="kd">var</span> <span class="nx">dependencies</span> <span class="o">=</span> <span class="p">{};</span>
    
    <span class="kd">var</span> <span class="nx">retrieve</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">record</span> <span class="o">=</span> <span class="nx">dependencies</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">record</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;No service registered with name: &#39;</span><span class="o">+</span><span class="nx">name</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">record</span><span class="p">[</span><span class="s1">&#39;cache&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">convert</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">record</span><span class="p">[</span><span class="s1">&#39;cache&#39;</span><span class="p">];</span>
    <span class="p">};</span>
    
    <span class="kd">var</span> <span class="nx">convert</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">record</span> <span class="o">=</span> <span class="nx">dependencies</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">record</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;service&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">record</span><span class="p">[</span><span class="s1">&#39;cache&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">instantiate</span><span class="p">(</span><span class="nx">record</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">record</span><span class="p">[</span><span class="s1">&#39;cache&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">record</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">};</span>
    
    <span class="kd">var</span> <span class="nx">instantiate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">wrapper</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
        <span class="p">};</span>
        <span class="nx">wrapper</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">wrapper</span><span class="p">(</span><span class="nx">getDependencies</span><span class="p">(</span><span class="nx">fn</span><span class="p">));</span>
    <span class="p">};</span>
    
    <span class="kd">var</span> <span class="nx">getDependencies</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="nx">getParameters</span><span class="p">(</span><span class="nx">fn</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">params</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">retrieve</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">getParameters</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
          <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/((\/\/.*$)|(\/\*[\s\S]*?\*\/)|(\s))/mg</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^function\s*[^\(]*\(\s*([^\)]*)\)/m</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
          <span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/,/</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">return</span> <span class="p">[];</span>
        <span class="k">return</span> <span class="nx">args</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">registerObject</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">dependency</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dependencies</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">dependency</span><span class="p">};</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">defineService</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">dependency</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dependencies</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;service&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">dependency</span><span class="p">};</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">lookup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">retrieve</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">invoke</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">target</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">getDependencies</span><span class="p">(</span><span class="nx">target</span><span class="p">));</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}();</span></code></pre></div>

<p>Khai báo các đối tượng và dịch vụ với <em>$injector</em>:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$injector</span><span class="p">.</span><span class="nx">registerObject</span><span class="p">(</span><span class="s1">&#39;greeting&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">greet</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;Hello world!&#39;</span><span class="p">;</span> <span class="p">}</span>
<span class="p">});</span>

<span class="nx">$injector</span><span class="p">.</span><span class="nx">defineService</span><span class="p">(</span><span class="s1">&#39;service1&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fullname</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="nx">fullname</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">sayHello</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Hello &#39;</span><span class="o">+</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot;. I&#39;m &quot;</span><span class="o">+</span><span class="nx">self</span><span class="p">)};</span> 
<span class="p">}).</span><span class="nx">registerObject</span><span class="p">(</span><span class="s1">&#39;fullname&#39;</span><span class="p">,</span> <span class="s1">&#39;Computer&#39;</span><span class="p">);</span>

<span class="nx">$injector</span><span class="p">.</span><span class="nx">defineService</span><span class="p">(</span><span class="s1">&#39;service2&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
    <span class="k">this</span><span class="p">.</span><span class="nx">sayWellcome</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span><span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;Wellcome to &#39;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">)};</span> 
<span class="p">});</span></code></pre></div>

<p>Gọi phương thức <em>$injector.lookup()</em> để sử dụng dịch vụ hoặc gọi phương thức <em>$injector.invoke()</em> để <em>bơm truyền</em> đối tượng và dịch vụ vào hàm:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$injector</span><span class="p">.</span><span class="nx">lookup</span><span class="p">(</span><span class="s1">&#39;service1&#39;</span><span class="p">).</span><span class="nx">sayHello</span><span class="p">(</span><span class="s1">&#39;Ubuntu&#39;</span><span class="p">);</span>

<span class="nx">$injector</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">greeting</span><span class="p">,</span> <span class="nx">service1</span><span class="p">,</span> <span class="nx">service2</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">greeting</span><span class="p">.</span><span class="nx">greet</span><span class="p">())</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">);</span>
    <span class="nx">service1</span><span class="p">.</span><span class="nx">sayHello</span><span class="p">(</span><span class="s1">&#39;Pham Ngoc Hung&#39;</span><span class="p">);</span>
    <span class="nx">service2</span><span class="p">.</span><span class="nx">sayWellcome</span><span class="p">(</span><span class="s1">&#39;Vietnam&#39;</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>

<h2 id="ti-liu-tham-kho">Tài liệu tham khảo</h2>

<ul>
  <li><a href="http://en.wikipedia.org/wiki/Dependency_injection">Giới thiệu về Dependency Injection - Wikipedia</a></li>
  <li><a href="http://en.wikipedia.org/wiki/Service_locator_pattern">Giới thiệu về Service Locator Pattern - Wikipedia</a></li>
  <li><a href="http://merrickchristensen.com/articles/javascript-dependency-injection.html">Một kỹ thuật cài đặt Dependency Injection trong Javascript - Merrick Christensen</a></li>
</ul>


            </div>
        </article>

        <div class="cf"></div>
        <div class="row text-center">
            <section class="cheryk-post-share">
                <a class="twitter-icon" href="https://twitter.com/intent/tweet?text=&quot;Tổng quan về Dependency Injection trong AngularJS (P1)&quot;%20/blog/javascript/angularjs/tong-quan-ve-dependency-injection-trong-angularjs-p1.html%20via%20&#64;pnhung177"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
                    <i class="fa fa-twitter"></i>
                </a>
                <a class="facebook-icon" href="https://www.facebook.com/sharer/sharer.php?u=/blog/javascript/angularjs/tong-quan-ve-dependency-injection-trong-angularjs-p1.html"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
                    <i class="fa fa-facebook"></i>
                </a>
                <a class="google-icon" href="https://plus.google.com/share?url=/blog/javascript/angularjs/tong-quan-ve-dependency-injection-trong-angularjs-p1.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title="Share on Google+">
                    <i class="fa fa-google-plus"></i>
                </a>
            </section>
        </div>
        <div class="cf"></div>
            <div class="cheryk-author-info">
                <div class="row">
                    <section class="cheryk-post-author small-12 columns">
                        
                            <img src="/blog/images/avatars/pnhung177.png" class="cheryk-post-author-avatar" alt="Phạm Ngọc Hùng's photo">
                        
                            <span class="author-label">Author</span>
                            <h1>Phạm Ngọc Hùng</h1>
                        
                            <p><a href="mailto:pnhung177@drupalex.net" class="author-website">pnhung177@drupalex.net</a></p>
                        
                            <p>... when the sun comes up, you better be running!</p>
                        
                    </section>
                </div>
            </div> 
        <div class="cf"></div>

        
        <section class="cheryk-disqus row">
    <div class="small-12 columns">
        <h1 class="cheryk-comments-header">Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'acegik'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
</section>

         
</main> 


<div class="cf"></div>
<footer class="cheryk-site-footer">
    <div class="copyright">
         <section>Bản quyền nội dung thuộc về <a href="/blog/about">Phạm Ngọc Hùng</a> &copy; 2015.</section>
    </div>
    <div class="social-icons">
        
        
        <a href="http://twitter.com/pnhung177">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-twitter fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="https://plus.google.com/u/3/115458186421626071505">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-google-plus fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="http://github.com/pnhung177">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-github fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="http://facebook.com/pnhung177">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-facebook fa-stack-1x"></i>
            </span>
        </a>
        
    </div>
    
    <div class="cf"></div>
</footer>

<script src="/blog/assets/js/vendor/modernizr.js"></script>
<script src="/blog/assets/js/foundation.min.js"></script>
<script src="/blog/assets/js/vendor/background-check.js"></script>
<script src="/blog/assets/js/vendor/post-header-animations.js"></script>
<script src="/blog/assets/js/main.js"></script>

<script>
  $(document).foundation();
</script>



<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54128248-1', 'auto');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');

</script>


  
</body>
</html>
