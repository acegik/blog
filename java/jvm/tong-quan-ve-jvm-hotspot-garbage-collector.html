<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>TổNG QUAN Về JVM: HOTSPOT GARBAGE COLLECTOR &vert; ACEGIK'S BLOG</title>
<meta name="description" content="... when the sun comes up, you better be running!">
<meta name="keywords" content="Java, Java Performance, JVM, HotSpot VM">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/blog/images/logo.png">
<meta name="twitter:title" content="Tổng quan về JVM: HotSpot Garbage Collector">
<meta name="twitter:description" content="... when the sun comes up, you better be running!">
<meta name="twitter:creator" content="@pnhung177">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Tổng quan về JVM: HotSpot Garbage Collector">
<meta property="og:description" content="... when the sun comes up, you better be running!">
<meta property="og:url" content="/blog/java/jvm/tong-quan-ve-jvm-hotspot-garbage-collector.html">
<meta property="og:site_name" content="Acegik's Blog">
<meta property="og:image" content="/blog/images/">





<link rel="canonical" href="/blog/java/jvm/tong-quan-ve-jvm-hotspot-garbage-collector.html">
<link href="/blog/feed.xml" type="application/atom+xml" rel="alternate" title="Acegik's Blog Feed">
<link rel="author" href="https://plus.google.com/u/3/115458186421626071505?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<link href='http://fonts.googleapis.com/css?family=Montserrat:400,700|Open+Sans:400,600,300,800,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="/blog/assets/css/font-awesome.min.css">
<link rel="stylesheet" href="/blog/assets/css/vendor/normalize.css">
<link rel="stylesheet" href="/blog/assets/css/vendor/foundation.min.css">
<link rel="stylesheet" href="/blog/assets/css/style.css">
<link rel="stylesheet" href="/blog/assets/css/post.css">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/blog/assets/js/vendor/jquery-1.11.1.min.js"><\/script>')</script>





<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/blog/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/blog/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/blog/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/blog/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/blog/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/blog/images/apple-touch-icon-144x144-precomposed.png">

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- Acegik - sidebar -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-2558234225933836"
     data-ad-slot="3073080904"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

</head>
<body class="post-template" itemscope itemtype="http://schema.org/WebPage">


        <main id="cheryk-post-container-simple" class="cheryk-post-container-simple" role="main">
            <header class="cheryk-post-header-simple">
                <div class="cheryk-post-menu-header-simple">

                    <a class="cheryk-blog-logo" href="/blog">
                        <img src="/blog/images/logo.png" alt="Blog Logo" />
                    </a>

                <div class="cheryk-blog-menu">      
    <div class="cheryk-mobile-menu show-for-small">
        <a href="#"><i class="fa fa-bars"></i></a>
    </div>
    <ul class="cheryk-menu">
        <li class="cheryk-mobile-close-btn show-for-small text-right">
            <a href="#"><i class="fa fa-times"></i></a>
        </li>

            <li>
                    <a href="/blog/">Trang bìa</a>
                 </li>

            <li>
                    <a href="/blog/featured">Danh sách</a>
                 </li>

            <li>
                    <a href="/blog/categories">Phân loại</a>
                 </li>

            <li>
                    <a href="/blog/about">Giới thiệu</a>
                 </li>
            
           <li><a href="/blog/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
    </ul>

</div>
            </div>

                <div class="cheryk-post-title-simple row">
                    <div class="small-12 columns">
                        <div class="cheryk-post-meta-simple">
                            <h1>Tổng quan về JVM: HotSpot Garbage Collector</h1>
                            <p>by <strong>pnhung177</strong> &#8212; on <a href="/blog/tags/index.html#Java" data-toggle="tooltip" title="Posts tagged with Java" rel="tag">Java</a>&nbsp;&comma;&nbsp;<a href="/blog/tags/index.html#Java Performance" data-toggle="tooltip" title="Posts tagged with Java Performance" rel="tag">Java Performance</a>&nbsp;&comma;&nbsp;<a href="/blog/tags/index.html#JVM" data-toggle="tooltip" title="Posts tagged with JVM" rel="tag">JVM</a>&nbsp;&comma;&nbsp;<a href="/blog/tags/index.html#HotSpot VM" data-toggle="tooltip" title="Posts tagged with HotSpot VM" rel="tag">HotSpot VM</a> &#8212; <strong><time datetime="2014-07-12T00:00:00+07:00">12/07/2014</time></strong></p>
                        </div>
                    </div>
                </div>
            </header>

        <article class="cheryk-post-content post tag-simple">
            <div><p>Bài viết này giới thiệu về HotSpot Garbage Collector, cũng như giải thích cơ chế hoạt động để người dùng hiểu rõ hơn cách thức mà Garbage Collector làm việc trong HotSpot VM, từ đó có thể khai thác triệt để những ưu điểm của nó trong việc thiết kế, phát triển và triển khai ứng dụng Java. Từ đây trở đi trong bài viết này, chúng ta quy ước gọi tắt Garbage Collector là GC.</p>

<h2 id="cu-trc-hotspot-garbage-collector">Cấu trúc HotSpot Garbage Collector</h2>

<p>HotSpot sử dụng mô hình <strong>Generational Garbage Collection</strong>, trong đó GC xác định các đối tượng “sống lâu” dựa trên số lượng lần thu nhặt rác mà đối tượng đó vượt qua được, tức là không bị xóa đi để GC thu hồi vùng nhớ. </p>

<p><img src="/blog/media/cc7aaeac-c2eb-4bf2-87a0-2995839e7b8e/hotspot-heap-structure.png" alt="Cấu trúc HotSpot Heap" /></p>

<p>Vùng nhớ do GC quản lý theo mô hình <strong>Generational Garbage Collection</strong> được chia làm 3 phần:</p>

<ul>
  <li><strong>Young Generation</strong>: được dùng để chứa các đối tượng mới được chương trình tạo. Vùng nhớ này được chia nhỏ thành 3 vùng con: vùng Eden và 2 vùng nhớ Survivor có tên là S0 và S1. Vùng nhớ Eden là nơi chứa các đối tượng vừa được khởi tạo. Các vùng nhớ Survivor được dùng để tính tuổi cho các đối tượng mới được chuyển qua từ vùng Eden.</li>
  <li><strong>Old Generation</strong> hay còn gọi là <strong>Tenured Generation</strong>: được dùng để chứa các đối tượng tồn tại lâu dài. Các đối tượng trong vùng <strong>Young Generation</strong> sau khi đã trải qua một số lần thu dọn rác nhất định, nếu vẫn tồn tại thì sẽ được chuyển qua vùng <strong>Old Generation</strong>.</li>
  <li><strong>Permanent Generation</strong>: được máy ảo sử dụng để chứa dữ liệu cần thiết để mô tả đối tượng. Ví dụ, đối tượng mô tả các lớp đối tượng (class) và phương thức (method) được lưu trữ trong vùng Permanent Generation.</li>
</ul>

<h2 id="cc-vng-nh-hot-ng-nh-th-no">Các vùng nhớ hoạt động như thế nào?</h2>

<h3 id="vng-nh-young-generation">Vùng nhớ Young Generation</h3>

<p>Vùng nhớ Young Generation được dùng để chứa những đối tượng vừa được chương trình tạo ra hoặc đã tồn tại trong chương trình một thời gian ngắn. Vùng nhớ này giãn nở nhanh chóng và khi đã đầy sẽ được <em>quá trình thu dọn nhỏ</em> (<strong>minor garbage collection</strong>) dọn dẹp các đối tượng không dùng nữa và chuyển những đối tượng tồn tại lâu dài sang vùng Old Generation. Cơ chế này được giải thích chi tiết như sau:</p>

<p><strong>1</strong>. Khi một đối tượng được tạo ra, nó được cấp phát bộ nhớ trong vùng Eden. Hai vùng nhớ Survivor S0 và S1 khi mới bắt đầu đều trống rỗng. Vùng nhớ Eden tiếp tục nhận các đối tượng mới tạo cho đến khi đầy.</p>

<p><img src="/blog/media/cc7aaeac-c2eb-4bf2-87a0-2995839e7b8e/gc-process--object-allocation.png" alt="Cấp phát bộ nhớ đối tượng trong vùng Eden" /> </p>

<p><strong>2</strong>. Khi Eden đầy, <em>quá trình thu dọn nhỏ</em> (<strong>minor garbage collection</strong>) được kích hoạt. Quá trình này quét qua toàn bộ vùng Eden, những đối tượng còn tham chiếu (Referenced object) sẽ được chuyển qua vùng Survivor thứ nhất (vùng S0), đồng thời được đánh dấu tuổi bằng 1. Những đối tượng hết tham chiếu (Unreferenced object) sẽ loại bỏ khi vùng Eden bị xóa vào cuối quá trình.</p>

<p><img src="/blog/media/cc7aaeac-c2eb-4bf2-87a0-2995839e7b8e/gc-process--ref-obj-is-copied-to-s0.png" alt="Minor gabage collection được kích hoạt" /> </p>

<p><strong>3</strong>. Với vùng Eden đã được dọn sạch ở bước trước, quá trình cấp phát bộ nhớ lại tiếp tục cho đến khi vùng này đầy. Quá trình thu dọn rác thứ cấp được kích hoạt trở lại. Trong lần này, các đối tượng “còn tham chiếu” trong Eden được chuyển sang vùng Servivor thứ hai (vùng S1). Sau đó, các đối tượng trong vùng S0 được chuyển từ Eden qua trong lần dọn trước sẽ được quét, những đối tượng “còn tham chiếu” sẽ được tăng số tuổi lên một đơn vị và được chuyển qua vùng Survivor S1. Cuối quá trình, vùng Eden và vùng S0 chỉ còn lại các đối tượng “hết tham chiếu” và sẽ bị xóa sạch.</p>

<p><img src="/blog/media/cc7aaeac-c2eb-4bf2-87a0-2995839e7b8e/gc-process--object-aging.png" alt="Tính tuổi cho các đối tượng &quot;còn tham chiếu&quot;" /></p>

<p><strong>4</strong>. Quá trình cấp phát bộ nhớ lại được lặp lại. Tuy nhiên, trong bước này, vai trò của S0 và S1 được hoán đổi với nhau: Khi Eden đầy, các đối tượng “còn tham chiếu” được chuyển từ Eden và S1 sang S0 và được tăng số tuổi. Cuối quá trình vùng Eden và S1 được dọn sạch.</p>

<p><img src="/blog/media/cc7aaeac-c2eb-4bf2-87a0-2995839e7b8e/gc-process--object-aging-continued.png" alt="Tính tuổi cho các đối tượng &quot;còn tham chiếu&quot; từ S1 qua S0" /></p>

<p><strong>5</strong>. Sau mỗi một lần thực hiện <em>quá trình thu dọn nhỏ</em>, nếu đối tượng nào có tuổi đạt được ngưỡng (chẳng hạn trong hình minh họa là 8), nó sẽ được thăng cấp (promote) từ vùng Young Generation lên vùng Old Generation (còn gọi là Tenured Generation).</p>

<p><img src="/blog/media/cc7aaeac-c2eb-4bf2-87a0-2995839e7b8e/gc-process--promotion.png" alt="Thăng cấp cho đối tượng" /></p>

<p><strong>6</strong>. Quá trình này được thực hiện lặp đi lặp lại liên tục. Chỉ những đối tượng tồn tại lâu dài (có tuổi đạt ngưỡng) thì mới được thăng cấp từ “Young Generation” qua vùng “Old Generation”.</p>

<p><img src="/blog/media/cc7aaeac-c2eb-4bf2-87a0-2995839e7b8e/gc-process--promotion-continued.png" alt="Thăng cấp cho đối tượng lặp lại liên tục" /></p>

<h3 id="vng-nh-old-generation">Vùng nhớ Old Generation</h3>

<p>Như đã đề cập ở phần trên, vùng nhớ Old Generation được dùng để lưu trữ các đối tượng tồn tại lâu dài được chuyển qua từ vùng nhớ Young Generation. Vùng nhớ Old Generation thường lớn hơn nhưng giãn nở chậm hơn so với Young Generation. Khi vùng nhớ này đầy, <em>quá trình thu dọn lớn</em> (<strong>major garbage collection</strong>) được kích hoạt để quét qua tất cả các đối tượng và loại bỏ các đối tượng “hết tham chiếu”. Quá trình thu dọn chính còn được gọi là <em>quá trình thu dọn toàn bộ</em> (<strong>full garbage collection</strong>).</p>

<p>Thông thường quá trình thu dọn lớn sẽ mất thời gian hơn rất nhiều (so với <em>quá trình thu dọn nhỏ</em>). Quá trình này cũng thuộc loại sự kiện “Stop the World”: ngưng tất cả mọi thứ trong khi nó vận hành. Do đó, đối với những ứng dụng có độ đáp ứng cao (responsive application), quá trình thu dọn lớn phải được hạn chế tối đa.</p>

<h3 id="vng-nh-permanent-generation">Vùng nhớ Permanent Generation</h3>

<p>Mặc dù tên gọi nằm trong nhóm “generation”, nhưng vùng nhớ này không nằm trong cơ cấu hoạt động dịch chuyển và thăng cấp đối tượng (tức là, các đối tượng do người lập trình tạo ra sẽ không bao giờ được chuyển từ vùng “Old generation” sang vùng “Permanent generation”). Thay vào đó, vùng nhớ này chỉ được sử dụng bởi HotSpot VM để lưu trữ <strong>metadata</strong>, chẳng hạn như các cấu trúc dữ liệu lớp đối tượng, interned strings, v.v. Ngoài ra, các lớp đối tượng thư viện và các phương thức của JavaSE cũng được chứa ở đây.</p>

<p>Các lớp đối tượng có thể có thể được gỡ bỏ nếu JVM nhận thấy không cần dùng chúng nữa. Việc thu dọn cũng được thực hiện trong một <em>quá trình thu dọn toàn bộ</em> (<strong>full garbage collection</strong>).</p>


            </div>
        </article>

        <div class="cf"></div>
        <div class="row text-center">
            <section class="cheryk-post-share">
                <a class="twitter-icon" href="https://twitter.com/intent/tweet?text=&quot;Tổng quan về JVM: HotSpot Garbage Collector&quot;%20/blog/java/jvm/tong-quan-ve-jvm-hotspot-garbage-collector.html%20via%20&#64;pnhung177"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
                    <i class="fa fa-twitter"></i>
                </a>
                <a class="facebook-icon" href="https://www.facebook.com/sharer/sharer.php?u=/blog/java/jvm/tong-quan-ve-jvm-hotspot-garbage-collector.html"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
                    <i class="fa fa-facebook"></i>
                </a>
                <a class="google-icon" href="https://plus.google.com/share?url=/blog/java/jvm/tong-quan-ve-jvm-hotspot-garbage-collector.html"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title="Share on Google+">
                    <i class="fa fa-google-plus"></i>
                </a>
            </section>
        </div>
        <div class="cf"></div>
            <div class="cheryk-author-info">
                <div class="row">
                    <section class="cheryk-post-author small-12 columns">
                        
                            <img src="/blog/images/avatars/pnhung177.png" class="cheryk-post-author-avatar" alt="Phạm Ngọc Hùng's photo">
                        
                            <span class="author-label">Author</span>
                            <h1>Phạm Ngọc Hùng</h1>
                        
                            <p><a href="mailto:pnhung177@drupalex.net" class="author-website">pnhung177@drupalex.net</a></p>
                        
                            <p>... when the sun comes up, you better be running!</p>
                        
                    </section>
                </div>
            </div> 
        <div class="cf"></div>

        
        <section class="cheryk-disqus row">
    <div class="small-12 columns">
        <h1 class="cheryk-comments-header">Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'acegik'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
</section>

         
</main> 


<div class="cf"></div>
<footer class="cheryk-site-footer">
    <div class="copyright">
         <section>Bản quyền nội dung thuộc về <a href="/blog/about">Phạm Ngọc Hùng</a> &copy; 2015.</section>
    </div>
    <div class="social-icons">
        
        
        <a href="http://twitter.com/pnhung177">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-twitter fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="https://plus.google.com/u/3/115458186421626071505">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-google-plus fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="http://github.com/pnhung177">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-github fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="http://facebook.com/pnhung177">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-facebook fa-stack-1x"></i>
            </span>
        </a>
        
    </div>
    
    <div class="cf"></div>
</footer>

<script src="/blog/assets/js/vendor/modernizr.js"></script>
<script src="/blog/assets/js/foundation.min.js"></script>
<script src="/blog/assets/js/vendor/background-check.js"></script>
<script src="/blog/assets/js/vendor/post-header-animations.js"></script>
<script src="/blog/assets/js/main.js"></script>

<script>
  $(document).foundation();
</script>



<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54128248-1', 'auto');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');

</script>


  
</body>
</html>
